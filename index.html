<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>OreStellar</title>

<!-- Google Font -->
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&display=swap" rel="stylesheet">

<style>
html, body {
  height: 100%;
  margin: 0;
  padding: 0;
  overflow: hidden;
  background: black;
  font-family: 'Orbitron', sans-serif;
  color: #00ff00;
}

/* STARFIELD BACKGROUND */
#stars {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: radial-gradient(ellipse at bottom, #020111 0%, #000000 100%);
  overflow: hidden;
  z-index: 0;
}

.star {
  position: absolute;
  background: white;
  border-radius: 50%;
  opacity: 0.8;
  animation: moveStars linear infinite;
}

@keyframes moveStars {
  from { transform: translateY(0px); }
  to { transform: translateY(1000px); }
}

/* HEADER LOGO */
header {
  position: relative;
  text-align: center;
  z-index: 2;
  padding-top: 20px;
}

#myHeader img {
  width: 240px;
  animation: neonPulse 3s ease-in-out infinite;
  cursor: pointer;
}

@keyframes neonPulse {
  0%, 100% { filter: drop-shadow(0 0 5px #00ffff) drop-shadow(0 0 20px #00ffff); }
  50% { filter: drop-shadow(0 0 15px #00ffff) drop-shadow(0 0 35px #00ffff); }
}

/* MAIN CONTAINER */
main {
  position: relative;
  text-align: center;
  z-index: 2;
  margin-top: 30px;
}

/* TEXTAREA */
textarea {
  width: 320px;
  height: 150px;
  background: rgba(0,0,0,0.6);
  border: 1px solid #00ff00;
  color: #00ff00;
  font-family: 'Orbitron', sans-serif;
  font-size: 0.9em;
  resize: none;
  box-shadow: 0 0 10px #00ff00;
  border-radius: 8px;
  padding: 10px;
}

textarea:focus {
  outline: none;
  box-shadow: 0 0 15px #00ff00;
}

/* BUTTONS */
button {
  background: transparent;
  border: 1px solid #00ff00;
  color: #00ff00;
  font-family: 'Orbitron', sans-serif;
  font-size: 1em;
  padding: 8px 16px;
  border-radius: 10px;
  box-shadow: 0 0 10px #00ff00;
  cursor: pointer;
  margin-top: 15px;
  transition: 0.3s;
}

button:hover {
  background: rgba(0,255,0,0.2);
  box-shadow: 0 0 15px #00ff00;
}

/* CONTRACTS */
.contracts {
  display: flex;
  justify-content: center;
  gap: 30px;
  margin-top: 30px;
  flex-wrap: wrap;
}

.contract {
  display: none;
  background: rgba(0,0,0,0.4);
  border: 1px solid #00ff00;
  box-shadow: 0 0 12px #00ff00;
  border-radius: 15px;
  width: 200px;
  height: 140px;
  position: relative;
}

.contract img {
  width: 100%;
  height: 100%;
  border-radius: 15px;
  opacity: 0.9;
}

.contract .total {
  position: absolute;
  bottom: 8px;
  right: 12px;
  color: #00ff00;
  text-shadow: 0 0 6px #00ff00;
  font-size: 1em;
}

/* SUMMARY CONTAINER */
#summaryContainer {
  display: none;
  background: rgba(10,10,10,0.85);
  border: 1px solid #00ff00;
  box-shadow: 0 0 15px #00ff00;
  border-radius: 10px;
  margin: 20px auto 0;
  max-width: 360px;
  width: 90%;
  max-height: 420px;
  overflow-y: auto;
  color: #00ff00;
  font-family: 'Orbitron', sans-serif;
  padding: 10px;
  text-align: left;
}

/* SUMMARY TABLE */
#summaryTable {
  width: 100%;
  border-collapse: collapse;
  font-size: 0.9em;
}

#summaryTable th, #summaryTable td {
  padding: 6px 10px;
  text-align: left;
  white-space: nowrap;
}

#summaryTable th {
  border-bottom: 1px solid #00ff00;
  text-shadow: 0 0 5px #00ff00;
}

#summaryTable td {
  text-shadow: 0 0 4px #00ff00;
}

#summaryTable .unrecognized td {
  color: #ff3333;
  text-shadow: 0 0 6px #ff3333;
}

/* TOTAL ISK LEDGER */
.summary-total {
  text-align: right;
  font-size: 1em;
  color: #00ff00;
  margin-top: 6px;
  text-shadow: 0 0 8px #00ff00;
}

/* SHARE SUMMARY BUTTON */
#shareButton {
  display: none;
  background: transparent;
  border: 1px solid #00ff00;
  color: #00ff00;
  font-family: 'Orbitron', sans-serif;
  font-size: 1em;
  padding: 8px 16px;
  border-radius: 10px;
  box-shadow: 0 0 10px #00ff00;
  cursor: pointer;
  margin: 20px auto;
  transition: 0.3s;
}
#shareButton:hover {
  background: rgba(0,255,0,0.2);
  box-shadow: 0 0 15px #00ff00;
}
</style>
</head>
<body>
<div id="stars"></div>

<header>
  <div id="myHeader">
    <img src="https://raw.githubusercontent.com/OreStellar/Orestellar.github.io/main/images/16f71443-963c-483c-a6c1.png" alt="OreStellar Logo">
  </div>
</header>

<main>
  <textarea id="message" placeholder="Paste your ore list here..."></textarea><br>
  <button id="submitBtn">Submit</button>

  <div class="contracts">
    <div id="contract1" class="contract">
      <img src="https://raw.githubusercontent.com/OreStellar/Orestellar.github.io/main/images/contract1.png" alt="Contract 1">
      <div class="total">0 ISK</div>
    </div>
    <div id="contract2" class="contract">
      <img src="https://raw.githubusercontent.com/OreStellar/Orestellar.github.io/main/images/contract2.png" alt="Contract 2">
      <div class="total">0 ISK</div>
    </div>
  </div>

  <div id="summaryContainer"></div>
  <button id="shareButton">Share Summary</button>
</main>

<script>
// STARFIELD
const starContainer = document.getElementById('stars');
for (let i = 0; i < 300; i++) {
  const star = document.createElement('div');
  star.className = 'star';
  const size = Math.random() * 2 + 1;
  star.style.width = size + 'px';
  star.style.height = size + 'px';
  star.style.top = Math.random() * 100 + '%';
  star.style.left = Math.random() * 100 + '%';
  star.style.animationDuration = 10 + Math.random() * 20 + 's';
  starContainer.appendChild(star);
}

// ===== CSV PRICE FETCH =====
const priceList = {};
fetch('https://raw.githubusercontent.com/OreStellar/Orestellar.github.io/main/data/prices.csv')
  .then(res => res.text())
  .then(csv => {
    const rows = csv.split('\n').slice(1);
    for (const row of rows) {
      const cols = row.split(',');
      if (cols.length >= 2) {
        const name = cols[0].trim().toLowerCase();
        const price = parseFloat(cols[1]);
        if (!isNaN(price)) priceList[name] = price;
      }
    }
  });

// ===== MAIN FUNCTION =====
function showContent() {
  const t = document.getElementById('message').value;
  const regex = /([\w\s]+?)\s+(\d+)/g;
  let match;
  let summary = [];
  let total = 0;

  while ((match = regex.exec(t)) !== null) {
    const nameRaw = match[1].trim();
    const qty = parseInt(match[2]);
    const name = nameRaw.toLowerCase();

    const foundKey = Object.keys(priceList).find(k => name.includes(k) || k.includes(name));

    if (foundKey) {
      const price = priceList[foundKey];
      const val = qty * price;
      summary.push({ name: nameRaw, price: price, qty: qty, val: val });
      total += val;
    } else {
      summary.push({ name: nameRaw, price: '?', qty: qty, val: 'Unrecognized', unrecognized: true });
    }
  }

  document.querySelectorAll('.contract').forEach(c => c.style.display = 'none');
  const summaryContainer = document.getElementById('summaryContainer');
  summaryContainer.style.display = 'block';

  let html = `<table id="summaryTable">
    <tr><th>Name</th><th>Price</th><th>Qty</th><th>Total</th></tr>`;
  summary.forEach(item => {
    html += `<tr class="${item.unrecognized ? 'unrecognized' : ''}">
      <td>${item.name}</td>
      <td>${item.price === '?' ? '?' : item.price.toLocaleString()}</td>
      <td>${item.qty.toLocaleString()}</td>
      <td>${item.val === 'Unrecognized' ? 'Unrecognized' : item.val.toLocaleString()}</td>
    </tr>`;
  });
  html += `</table><div class="summary-total">Total ISK: ${total.toLocaleString()}</div>`;
  summaryContainer.innerHTML = html;

  document.getElementById('shareButton').style.display = 'inline-block';
}

// ===== SHARE SUMMARY =====
document.getElementById('shareButton').addEventListener('click', () => {
  const data = encodeURIComponent(document.getElementById('message').value);
  const shareUrl = `${location.origin}${location.pathname}?inv=${data}`;
  navigator.clipboard.writeText(shareUrl);
  alert('Share Summary URL Copied!');
});

// ===== SUBMIT =====
document.getElementById('submitBtn').addEventListener('click', showContent);

// ===== LOGO REFRESH =====
document.getElementById('myHeader').addEventListener('click', () => location.reload());

// ===== AUTO LOAD SHARED SUMMARY =====
window.addEventListener('DOMContentLoaded', () => {
  const params = new URLSearchParams(window.location.search);
  if (params.has('inv')) {
    document.getElementById('message').value = decodeURIComponent(params.get('inv'));
    showContent();
  }
});
</script>
</body>
</html>
