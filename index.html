<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>OreStellar</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Chivo+Mono:wght@400;700&display=swap" rel="stylesheet">
<style>

/* ----------------- Scrollbars ----------------- */
/* WebKit browsers (Chrome, Edge, Safari) */
#ratesContainer::-webkit-scrollbar {
    width: 8px;              /* scrollbar width */
    background: transparent;  /* make the scrollbar track transparent */
}
#ratesContainer::-webkit-scrollbar-thumb {
    background: rgba(255, 255, 255, 0.2); /* faint thumb */
    border-radius: 4px;
}
#ratesContainer::-webkit-scrollbar-thumb:hover {
    background: rgba(255, 255, 255, 0.4); /* brighter on hover */
}

/* Firefox */
#ratesContainer {
    scrollbar-width: thin;       
    scrollbar-color: rgba(255,255,255,0.2) transparent;
}

/* ----------------- Body & Global ----------------- */
body {
    margin: 0;
    padding: 0;
    font-family: 'Orbitron', sans-serif;
    background-color: #000;
    color: #fff;
    overflow-x: hidden;
}

/* ----------------- Neon / Glow ----------------- */
.neon {
    color: #ffffff;
    text-shadow:
        0 0 5px #6e6e6e,
        0 0 10px #d1d1d1,
        0 0 20px #dadada,
        0 0 40px rgb(245, 245, 245),
        0 0 80px rgba(255, 255, 255, 0.603);
}

/* ----------------- Starfield layers ----------------- */
#staticStars,
#starfield {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
}
#staticStars { z-index: -2; opacity: 0.4; }
#starfield { z-index: -1; }

/* ----------------- Overlay ----------------- */
#overlay {
    display: none;
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.5);
    z-index: 10;
}
#overlay.active {
    display: block;
    opacity: 1;
    visibility: visible;
}

/* ----------------- Modals ----------------- */
.modal {
    display: none;
    position: fixed;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    background: #111;
    padding: 1rem;
    z-index: 11;
}
.modal.active { display: block; }

/* ----------------- Logo ----------------- */
#logo {
    text-align: center;
    font-size: 4rem;
    margin: 110px 0;
    transform: skewX(-10deg);
}

/* ----------------- Containers ----------------- */
#contractsContainer {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    gap: 20px;
    width: 100%;
    max-width: 1200px;
    margin: 40px auto;
    flex-wrap: nowrap;
    box-sizing: border-box;
}

#inventoryContainer {
    width: 80%;
    max-width: 500px;
    margin: 40px auto;
    padding: 20px;
    background: rgba(17,17,17,0.623);
    border: 1px solid rgba(0,0,0,0.411);
    border-radius: 12px;
    position: relative;
    box-sizing: border-box;
    overflow: hidden;
}
#inventoryContainer textarea {
    width: 100%;
    height: 150px;
    background: rgba(22,22,22,0.644);
    border: 1px solid #000;
    border-radius: 8px;
    color: #fff;
    font-family: 'Chivo Mono', monospace;
    font-size: 1rem;
    padding: 10px;
    resize: vertical;
    box-sizing: border-box;
}

    #ratesContainer {
    display: none;
    position: fixed;  /* important so z-index applies correctly */
    top: 50%;
    left: 50%;
    width: 100%;
    max-width: 90%;
    min-width: 90%;
    min-height: 90%;
    transform: translate(-50%, -50%);
    background: #111;
    padding: 20px;
    border-radius: 12px;
    z-index: 11;  /* <-- must be higher than overlay (10) */
}

#summaryContainer {
    font-family: 'Chivo Mono', monospace;
    width: 100%;
    max-width: 100%;
    min-width: 500px;
    background: rgba(255,255,255,0.05);
    border: 1px solid rgba(255,255,255,0.3);
    border-radius: 12px;
    padding: 20px;
    box-shadow: 0 0 15px rgba(255,255,255,0.2);
    display: none;
    overflow-x: hidden;
    overflow-y: visible;
    position: relative;
    flex: 1;
    margin: 0 auto;
}
/*SUMMARY TABLE STUFF*/
.summary-table {
  width: 100%;                       /* ✅ fill the container */
  border-collapse: collapse;          /* remove gaps between cells */
  margin-top: 10px;
  color: #fff;
  text-align: center;                 /* optional: center text */
  table-layout: fixed;                /* ensures equal column widths */
}

.summary-table th,
.summary-table td {
  padding: 8px 12px;
  border: 1px solid rgba(255, 255, 255, 0.2);
  word-wrap: break-word;              /* prevent overflow */
}

.summary-table th {
  background: rgba(255, 255, 255, 0.1);
  font-weight: bold;
}

.summary-table tr:nth-child(even) {
  background: rgba(255, 255, 255, 0.05);
}

#contractRight {
    display: none;
    position: fixed;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%) scale(0.8);
    background: #111;
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 10px 40px rgba(0,0,0,0.5);
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s ease, transform 0.3s ease, visibility 0.3s ease;
    z-index: 11;
    max-width: 90%;
    max-height: 90%;
    overflow-y: auto;
}
#contractRight.active {
    display: block;
    opacity: 1;
    visibility: visible;
    transform: translate(-50%, -50%) scale(1);
}

#contractRightLogo { display: none; cursor: pointer; }

/* ----------------- Buttons ----------------- */
#submitButton {
    padding: 12px 30px;
    background: none;
    border: 2px solid rgb(65,65,65);
    border-radius: 10px;
    color: #fff;
    font-size: 1.2rem;
    cursor: pointer;
    transition: all 0.3s;
    text-shadow: 0 0 5px #fff, 0 0 10px #fff;
}
#submitButton:hover {
    background: rgba(0,0,0,0.5);
    box-shadow: 0 0 20px #fff, 0 0 40px #fff;
}

#buttonContainer {
    display: flex;
    justify-content: center;
    gap: 20px;
    margin-top: 20px;
}

/* ----------------- Contract Boxes ----------------- */
.contract-container {
    position: fixed;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(0,0,0,0.9);
    color: #fff;
    padding: 20px;
    border-radius: 15px;
    z-index: 20;
    min-width: 300px;
    max-width: 400px;
    box-shadow: 0 0 20px #fff;
}

.contract-container,
.contract-table th,
.contract-table td {
    font-family: 'Chivo Mono', monospace;
}

.contract-table {
    width: 100%;
    border-collapse: collapse;
}
.contract-table th, .contract-table td {
    text-align: left;
    white-space: nowrap;
    padding: 6px 4px;
}
.contract-table th { font-weight: 600; }

.glow-bullet {
    color: rgba(72, 255, 0, 0.473);
    margin-left: 3px;
    width: 1ch;
    text-align: center;
}

/* ----------------- Side Tabs ----------------- */
#sideTabsContainer {
    position: fixed;
    top: 10%;
    right: 0;
    display: flex;
    flex-direction: column;
    gap: 15px;
    z-index: 11;
}
.sideTab {
    position: relative;
    display: flex;
    align-items: center;
    justify-content: flex-start;
    width: 250px;
    height: 30px;
    background: linear-gradient(145deg, rgba(0,255,255,0.05), rgba(0,255,255,0.1));
    border: 2px solid rgba(0,0,0,0.5);
    border-left: none;
    border-radius: 25px;
    color: #fff;
    cursor: pointer;
    text-shadow: 0 0 5px #fff, 0 0 10px #fff;
    box-shadow: 0 0 10px #fff;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    gap: 10px;
    transform: translateX(-200x);
}
.sideTab:hover {
    transform: translateX(-150px);
    box-shadow: 0 0 20px #fff, 0 0 40px #fff;
}

#ratesTab svg {
  position: relative;
  left: 5px;
}

#compareTab svg {
  position: relative;
  left: 5px;
}


</style>
</head>
<body>

<canvas id="staticStars"></canvas>
<canvas id="starfield"></canvas>
<div id="overlay" style="display:none;"></div>
<div id="logo" class="neon">OreStellar</div>
<div id="inventoryContainer">

  <p class="PasteText">Paste Your Inventory Below</p>

  <textarea id="messageBox" placeholder="Enter your ores here..."></textarea>
  <div id="buttonContainer">
    <button id="submitButton">Submit</button>
  </div>

</div>
  <div id="sideTabsContainer">
<!-- Side Tabs with Icons -->
<div id="ratesTab" class="sideTab">
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="cyan" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path d="M3 5h.01"/>
    <path d="M3 12h.01"/>
    <path d="M3 19h.01"/>
    <path d="M8 5h13"/>
    <path d="M8 12h13"/>
    <path d="M8 19h13"/>
  </svg>
  <span>Rates</span>
</div>


<!-- Compare tab with scale icon -->
<div id="compareTab" class="sideTab">
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="lime" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path d="m16 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z"/>
    <path d="m2 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z"/>
    <path d="M7 21h10"/>
    <path d="M12 3v18"/>
    <path d="M3 7h2c2 0 5-1 7-2 2 1 5 2 7 2h2"/>
  </svg>
</div>
</div>
<div id="contractsContainer">

  <div id="summaryContainer" style="display: none;"></div>

<!-- SVG Logo -->
<div id="contractRightLogo" class="open-modal" data-modal="contractRight" style="cursor:pointer;">
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-sticky-note-icon lucide-sticky-note">
    <path d="M16 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V8Z"/>
    <path d="M15 3v4a2 2 0 0 0 2 2h4"/>
  </svg>
</div>

<!-- Modal -->
<div id="contractRight" class="contract-container modal">

  <table class="contract-table">
    <tr>
      <th>Contract Type<span class="glow-bullet">•</span></th>
      <td>Item Exchange</td>
    </tr>
    <tr>
      <th>Availability<span class="glow-bullet">•</span></th><td>Private</td>
    </tr>
    <tr>
      <th>Name<span class="glow-bullet">•</span></th>
      <td>OreStellar</td>
    </tr>
    <tr>
      <th>I will pay<span class="glow-bullet">•</span></th>
      <td>0</td>
    </tr>
    <tr>
      <th>I will receive<span class="glow-bullet">•</span></th>
      <td id="contract-right-receive">0</td>
    </tr>
    <tr>
      <th>Expiration<span class="glow-bullet">•</span></th>
      <td>1 week</td>
    </tr>
    <tr>
      <th>Description<span class="glow-bullet">•</span></th>
      <td>That was Stellar!</td>
    </tr>
  </table>
</div>
</div>
<div id="ratesContainer" class="open-modal neon" style="display:none;">
  <button id="ratesClose">✕</button>
  <input type="text" id="searchInput" placeholder="WHAT GOES HERE">
  <div id="ratesGrid"></div>
</div>

<div id="compareContainer" class="neon" style="display:none;">
  <!-- Compare content here -->
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    // --- DOM Elements ---
    const submitButton = document.getElementById('submitButton');
    const messageBox = document.getElementById('messageBox');
    const summaryContainer = document.getElementById('summaryContainer');
    const inventoryContainer = document.getElementById('inventoryContainer');
    const oreStellarLogo = document.getElementById('logo');

    const contractRight = document.getElementById('contractRight');
    const contractRightLogo = document.getElementById('contractRightLogo');
    const overlay = document.getElementById('overlay');

    const ratesTab = document.getElementById('ratesTab');
    const compareTab = document.getElementById('compareTab');
    const ratesContainer = document.getElementById('ratesContainer');
    const compareContainer = document.getElementById('compareContainer');

    const panels = {
        contractRight: contractRight,
        summaryContainer: summaryContainer,
        compareContainer: compareContainer,
        ratesContainer: ratesContainer
    };

    const tabs = {
        contractRight: contractRightLogo,
        compareContainer: compareTab,
        ratesContainer: ratesTab
    };

    let openPanel = null;

    // --- Default visibility ---
    inventoryContainer.style.display = 'block';
    oreStellarLogo.style.display = 'block';
    contractRight.style.display = 'none';
    summaryContainer.style.display = 'none';
    compareContainer.style.display = 'none';
    ratesContainer.style.display = 'none';
    overlay.style.display = 'none';

    // --- Show Panel (fixed: no toggling) ---
    function showPanel(panelKey) {
        if (!panelKey) return; // nothing to open

        // Close any other panel
        
        Object.keys(panels).forEach(key => {
            if (key !== panelKey) panels[key].style.display = 'none';
        });

        // Open this panel
        panels[panelKey].style.display = 'block';
        overlay.style.display = 'block';
        openPanel = panelKey;
    }

    // --- Overlay click closes panels ---
    overlay.addEventListener('click', () => {
        Object.keys(panels).forEach(key => panels[key].style.display = 'none');
        overlay.style.display = 'none';
        openPanel = null;
    });


    // --- Rates Tab ---
    ratesTab.addEventListener('click', (e) => {
        e.stopPropagation();      // prevent event bubbling
        showRatesGrid();          // populate and show rates container
    });

    // --- Compare Tab ---
    compareTab.addEventListener('click', (e) => {
        e.stopPropagation();
        showPanel('compareContainer');
    });

    // --- Contract Tab ---
    contractRightLogo.addEventListener('click', (e) => {
        e.stopPropagation();
        showPanel('contractRight');
    });

function showRatesGrid() {
    console.log("showRatesGrid() called");
    
    if (!csvLoaded) {
        console.warn("Price data not loaded yet.");
        return;
    }
    console.log("CSV data loaded:", priceData);

    // --- Create search input if not already present ---
    let searchInput = document.getElementById('ratesSearchInput');
    if (!searchInput) {
        console.log("Creating search input...");
        searchInput = document.createElement('input');
        searchInput.id = 'ratesSearchInput';
        searchInput.placeholder = "Begin typing to search orelist..";
        searchInput.style.width = "55%";
        searchInput.style.marginBottom = "10px";
        searchInput.style.padding = "5px";
        searchInput.style.borderRadius = "6px";
        searchInput.style.border = "1px solid rgba(255,255,255,0.2)";
        searchInput.style.background = "rgba(0,0,0,0.3)";
        searchInput.style.color = "#fff";
        searchInput.style.fontFamily = "'Chivo Mono', monospace";
        ratesContainer.appendChild(searchInput);
    }

    // --- Create grid container ---
    let grid = document.getElementById('ratesGridContainer');
    if (!grid) {
        console.log("Creating grid container...");
        grid = document.createElement('div');
        grid.id = 'ratesGridContainer';
        grid.style.display = "grid";
        grid.style.gridTemplateColumns = "repeat(auto-fill, minmax(140px, 1fr))";
        grid.style.gap = "8px";
        ratesContainer.appendChild(grid);
    }

    // Clear previous items but keep search input and grid container
    grid.innerHTML = '';
    console.log("Grid cleared");

    // --- Populate grid ---
    const ores = Object.keys(priceData);
    console.log("Number of ores to display:", ores.length);

    ores.forEach((ore, index) => {
        if (ore.toLowerCase().startsWith('compressed ')) {
            console.log("Skipping compressed ore:", ore);
            return;
        }

        const entry = priceData[ore];
        if (!entry) {
            console.warn("No price data for ore:", ore);
            return;
        }

        const cell = document.createElement('div');
        cell.className = 'grid-item neon';
        cell.style.opacity = 0;
        cell.style.padding = "8px";
        cell.style.borderRadius = "6px";
        cell.style.textAlign = "center";
        cell.style.background = "rgba(0,255,255,0.05)";
        cell.style.boxShadow = "0 0 10px #fff, 0 0 20px #fff";
        cell.innerHTML = `<strong>${ore}</strong><br><span>${entry.price150.toLocaleString(undefined,{minimumFractionDigits:2, maximumFractionDigits:2})}</span>`;
        grid.appendChild(cell);

        console.log(`Created grid cell for ${ore}:`, entry.price150);

        // Fade-in animation
        setTimeout(() => {
            cell.style.transition = "opacity 0.4s ease, transform 0.3s ease, box-shadow 0.3s ease";
            cell.style.opacity = 1;
            cell.style.transform = "translateY(0)";
        }, index * 20);
    });

    // --- Filter function ---
    searchInput.oninput = () => {
        const filter = searchInput.value.toLowerCase();
        console.log("Filtering rates grid with:", filter);
        grid.querySelectorAll('.grid-item').forEach(item => {
            const text = item.textContent.toLowerCase();
            if (text.includes(filter)) {
                item.style.opacity = '1';
                item.style.boxShadow = '0 0 15px #fff, 0 0 30px #fff';
            } else {
                item.style.opacity = '0.3';
                item.style.boxShadow = '0 0 5px #C4C4C4, 0 0 10px #C4C4C4';
            }
        });
    };

    // --- Close button ---
    let closeBtn = document.getElementById('ratesClose');
    if (!closeBtn) {
        console.log("Creating close button...");
        closeBtn = document.createElement('div');
        closeBtn.id = 'ratesClose';
        closeBtn.innerHTML = '✕';
        closeBtn.style.position = 'absolute';
        closeBtn.style.top = '5px';
        closeBtn.style.right = '10px';
        closeBtn.style.cursor = 'pointer';
        closeBtn.style.fontSize = '1.2rem';
        closeBtn.style.color = 'rgba(255,255,255,0.8)';
        closeBtn.style.transition = 'color 0.2s';
        closeBtn.onmouseover = () => closeBtn.style.color = '#fff';
        closeBtn.onmouseout = () => closeBtn.style.color = 'rgba(255,255,255,0.8)';
        ratesContainer.appendChild(closeBtn);

        closeBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            console.log("Closing rates container");
            ratesContainer.style.display = 'none';
            overlay.style.display = 'none';
            openPanel = null;
        });
    }

    // --- Show container & overlay ---
    console.log("Showing rates container");
    ratesContainer.style.display = 'block';
    overlay.style.display = 'block';
    openPanel = 'ratesContainer';
}

// --- Parse Inventory Text ---
function parseInventoryText(input) {
  const lines = input.split('\n');
  const results = [];
  console.log("Parsing inventory input:", input);

  lines.forEach((line, i) => {
    const match = line.match(/^(.+?)\s+([\d.]+)$/); // support floats
    if (match) {
      const ore = match[1].trim();
      const quantity = parseFloat(match[2]);
      results.push({ ore, quantity });
      console.log(`Parsed line ${i}:`, ore, quantity);
    } else {
      console.warn(`Line ${i} did not match pattern:`, line);
    }
  });

  console.log("Parsed inventory results:", results);
  return results;
}


 submitButton.addEventListener('click', () => {
  const input = messageBox.value.trim();
  if (!input) {
    console.warn("Submit clicked with empty input.");
    return;
  }

  console.log("Submit clicked. Inventory input:", input);
  const parsedLines = parseInventoryText(input);
  if (!parsedLines.length) console.warn("No valid ores found.");

  // Hide inventory, show summary
  inventoryContainer.style.display = 'none';
  summaryContainer.style.display = 'block';
  contractRightLogo.style.display = 'inline-block';
  summaryContainer.innerHTML = '';

  const table = document.createElement('table');
  table.classList.add('summary-table');
  const thead = document.createElement('thead');
  thead.innerHTML = `<tr>
      <th>Ore</th>
      <th>Quantity</th>
      <th>Unit Price</th>
      <th>Compressed</th>
      <th>Total</th>
  </tr>`;
  table.appendChild(thead);

  const tbody = document.createElement('tbody');
  table.appendChild(tbody);
  summaryContainer.appendChild(table);

  let grandTotal = 0;

  parsedLines.forEach((item, index) => {
    const displayName = item.ore.replace(/^Compressed\s+/i, '');
    const isCompressed = item.ore.toLowerCase().startsWith('compressed ') ? '✅' : '❌';
    const unitPrice = priceData[item.ore]?.price150 || 0;
    const total = item.quantity * unitPrice;
    grandTotal += total;

    const row = document.createElement('tr');
    row.innerHTML = `<td style="text-align:center;">${displayName}</td>
                     <td style="text-align:right;">${item.quantity}</td>
                     <td style="text-align:right;">${unitPrice.toFixed(2)}</td>
                     <td style="text-align:center;">${isCompressed}</td>
                     <td style="text-align:right;">${total.toFixed(2)}</td>`;
    tbody.appendChild(row);

    console.log(`Row ${index}: ${displayName} | Qty: ${item.quantity} | Unit: ${unitPrice} | Total: ${total}`);
  });

  console.log("Grand Total:", grandTotal);
  document.getElementById('contract-right-receive').textContent = grandTotal.toFixed(2);


        rows.forEach(({ row, quantity, unitPrice, total }, index) => {
            const qtyCell = row.cells[1];
            const priceCell = row.cells[2];
            const totalCell = row.cells[4];
            totalCell.style.color = "#00ff00";
            setTimeout(() => {
                animateValue(qtyCell, 0, quantity, 500);
                animateValue(priceCell, 0, unitPrice, 500, true);
                animateValue(totalCell, 0, total, 500, true);
                row.style.animation = `fadeInRow 0.4s ease forwards`;
            }, delay);
            delay += animationDelay;
        });

        const totalRow = document.createElement('tr');
        totalRow.innerHTML = `<td colspan="4" style="text-align:right;font-weight:bold;">Grand Total</td>
                              <td style="text-align:right;font-weight:bold;">0.00</td>`;
        tbody.appendChild(totalRow);
        const grandCell = totalRow.querySelector('td:last-child');
        grandCell.style.color = "#00ff00";
        setTimeout(() => animateValue(grandCell,0,grandTotal,800,true), delay+200);
 });
      
  
    // --- Animate numeric values ---
    function animateValue(cell, start, end, duration = 500, isFloat = false) {
        const startTime = performance.now();
        function update(time) {
            const elapsed = time - startTime;
            const progress = Math.min(elapsed / duration, 1);
            const value = start + (end - start) * progress;
            cell.textContent = isFloat ? value.toFixed(2) : Math.round(value);
            if (progress < 1) requestAnimationFrame(update);
        }
        requestAnimationFrame(update);
    }

// --- Price Data ---
  let priceData = {};
let csvLoaded = false;

fetch('https://raw.githubusercontent.com/OreStellar/Orestellar.github.io/main/data/prices.csv')
  .then(res => res.text())
  .then(text => {
    if (!text || !text.includes(',')) {
      console.error("CSV fetch succeeded but no valid CSV content found:", text.slice(0, 100));
      return;
    }

    const lines = text.trim().split(/\r?\n/); // split into lines
    const headers = lines[0].split(',').map(h => h.trim());
    console.log("CSV headers:", headers);

    const priceIndex = headers.indexOf('Suggested Buy Price @ 150%');
    if (priceIndex === -1) {
      console.error("Column 'Suggested Buy Price @ 150%' not found");
      return;
    }

    priceData = {};
    // Only process lines 2-191 (indexes 1-190)
    for (let i = 1; i <= 190 && i < lines.length; i++) {
      const cols = lines[i].split(',');
      if (cols.length < headers.length) {
        console.warn(`Skipping malformed line ${i + 1}:`, lines[i]);
        continue;
      }

      const ore = cols[0].trim();
      const price = parseFloat(cols[priceIndex].trim()) || 0;
      priceData[ore] = { price150: price };
    }

    csvLoaded = true;
    console.log("Price data loaded:", priceData);
  })
  .catch(err => console.error("Error loading CSV:", err));

// --- CSS injection for grid dynamically injects a <style> tag into your page’s <head> with all the CSS needed for your rates grid layout.

const style = document.createElement('style');
style.innerHTML = `

#ratesContainer .grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
  gap: 8px;
}
#ratesContainer .grid-item {
    display: flex;
    flex-direction: column;       /* stack vertically */
    justify-content: space-between; /* pushes first item up, last item down */
    background: rgba(0,255,255,0.05);
    padding: 8px;
    border-radius: 6px;
    text-align: center;
    font-size: 0.85rem;
    box-shadow: 0 0 10px #fff, 0 0 20px #fff;
    transform: translateY(10px);
    transition: transform 0.2s, box-shadow 0.3s;
  height: 60px; /* or whatever is half of the current height */
  width: 90px;
}


#ratesContainer .grid-item:hover {
  transform: scale(1.05);
}
`;
document.head.appendChild(style);


// Dynamically update "I will receive" value
function updateGrandTotal(value) {
  document.getElementById('grandTotalCell').textContent = value.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 });
}


/* --- Static Background Stars --- */
const staticCanvas = document.getElementById('staticStars');
const sctx = staticCanvas.getContext('2d');

function resizeStatic() {
  staticCanvas.width = window.innerWidth;
  staticCanvas.height = window.innerHeight;
  drawStaticStars();
}
window.addEventListener('resize', resizeStatic);

function drawStaticStars() {
  sctx.clearRect(0, 0, staticCanvas.width, staticCanvas.height);
  const totalStaticStars = 3200;

  for (let i = 0; i < totalStaticStars; i++) {
    const x = Math.random() * staticCanvas.width;
    const y = Math.random() * staticCanvas.height;

    // small, visible stars
    let size = 0.5 + Math.random() * 0.8;
    let alpha = 0.3 + Math.random() * 0.7;
    let color = '255,255,255';

    const roll = Math.random();
    if (roll < 0.008) color = '255,180,180';  // pink
    else if (roll < 0.015) color = '255,80,80'; // red
    else if (roll < 0.02) color = '255,255,180'; // yellow

    sctx.fillStyle = `rgba(${color},${alpha})`;
    sctx.fillRect(x, y, size, size);
  }
}
resizeStatic();

/* --- Animated Flickering Stars --- */
/* --- Animated Flickering Stars --- */
const canvas = document.getElementById('starfield');
const ctx = canvas.getContext('2d');

let stars = [];
const totalStars = 300;           // total animated stars
const twinkleChance = 0.05;       // only 5% twinkle

function resizeCanvas() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  generateStars();
}
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

function generateStars() {
  stars.length = 0;

  for (let i = 0; i < totalStars; i++) {
    // Cluster logic
    let x, y;
    if (Math.random() < 0.8) { // 30% stars in clusters
      const cx = (Math.random() * 0.8 + 0.1) * canvas.width;
      const cy = (Math.random() * 0.8 + 0.1) * canvas.height;
      x = cx + (Math.random() - 0.5) * 150;
      y = cy + (Math.random() - 0.5) * 150;
    } else {
      x = Math.random() * canvas.width;
      y = Math.random() * canvas.height;
    }

    // Determine color (<2% chance for colored)
    const roll = Math.random();
    let color = '255,255,255'; // default white
    if (roll < 0.006) color = '255,180,180';    // light pink
    else if (roll < 0.012) color = '255,80,80'; // red
    else if (roll < 0.018) color = '255,255,180'; // yellow

    // Small radius
    const r = 0.5 + Math.random() * 1.5;

    stars.push({
      x,
      y,
      r,
      color: `rgb(${color})`,
      twinkle: Math.random() < twinkleChance,
      flickerOffset: Math.random() * Math.PI * 2,
      flickerSpeed: 0.005 + Math.random() * 0.04, // slow
      flickerIntensity: 0.05 + Math.random() * 0.05
    });
  }
}

function drawStars() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  for (const s of stars) {
    let alpha = 1;
    if (s.twinkle) {
      alpha = 0.7 + s.flickerIntensity * Math.sin(Date.now() * 0.005 + s.flickerOffset);
    }

    ctx.beginPath();
    ctx.fillStyle = s.color;
    ctx.globalAlpha = alpha;
    ctx.arc(s.x, s.y, s.r, 0, Math.PI * 2);
    ctx.fill();
  }

  ctx.globalAlpha = 1;
  requestAnimationFrame(drawStars);
}

drawStars();






});


</script>
</div>
</body>
</html>
