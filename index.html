<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>OreStellar</title>

<!-- Google Font: Orbitron -->
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&display=swap" rel="stylesheet">

<!-- LZString for URL compression -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/lz-string/1.4.4/lz-string.min.js"></script>

<style>
html, body {margin:0; padding:0; height:100%; overflow:hidden; background:black; font-family:monospace; color:white;}
canvas#starfield{position:fixed; top:0; left:0; width:100%; height:100%; z-index:0; pointer-events:none;}

.container-wrapper{display:flex; flex-direction:column; align-items:center; justify-content:center; min-height:100vh; gap:20px; padding:20px; z-index:2; position:relative;}
#myHeader{display:flex; justify-content:center; align-items:center; flex-direction:column; text-align:center; width:100%; max-width:650px; margin-bottom:30px; cursor:pointer; z-index:2;}
#logoText{display:inline; font-family:'Orbitron',sans-serif; font-weight:700; font-size:4.5rem; letter-spacing:0; color:rgba(255,255,255,0.1); transform:skewX(-8deg);}
#logoText span{display:inline; color:rgba(255,255,255,0.1); text-shadow:none;}

@keyframes softGlow{0%,100%{text-shadow:0 0 5px #fff;color:rgba(255,255,255,0.75);}50%{text-shadow:0 0 15px #fff;color:rgba(255,255,255,1);}}
@keyframes flickerRapid{0%,20%,40%,60%,80%,100%{color: rgba(255,255,255,1); text-shadow:0 0 10px #fff;}10%,30%,50%,70%,90%{color: rgba(255,255,255,0.1); text-shadow:none;}}
@keyframes flickerQuick{0%,50%,100%{color: rgba(255,255,255,0.1); text-shadow:none;}25%,75%{color: rgba(255,255,255,1); text-shadow:0 0 10px #fff;}}

.main-container{width:650px; max-width:90%; padding:30px; display:flex; flex-direction:column; justify-content:center; align-items:center; background-color:rgba(20,20,20,0.92); border-radius:15px;}
.main-container textarea#message{display:block; margin:0 auto; width:92%; font-size:18px; padding:18px; border-radius:10px; resize:vertical; background-color:rgba(17,17,17,0.97); color:#fff; border:1px solid #333; text-align:left; font-family:'Share Tech Mono', monospace; box-shadow:inset 0 0 5px #111; transition: all 0.2s ease-in-out;}
.main-container textarea#message::placeholder{color:#fff; opacity:0.6;}
textarea#message:focus{outline:none; border-color:#fff; box-shadow:inset 0 0 15px #fff,0 0 25px #fff; transition:box-shadow 0.3s ease,border-color 0.3s ease;}

.actionButton{margin-top:15px;background:linear-gradient(145deg,#161616,#242424);color:#fff;border:2px solid #ccc;border-radius:10px;padding:15px 35px;font-weight:bold;font-family:'Orbitron',sans-serif;cursor:pointer;position:relative;overflow:hidden;text-shadow:0 0 2px #fff;box-shadow:0 0 6px #ffffff33,0 0 12px #ffffff11 inset;animation:ambientGlow 3.5s ease-in-out infinite alternate;transition:all 0.35s ease;}
@keyframes ambientGlow{0%{box-shadow:0 0 4px #ffffff33,0 0 8px #ffffff11 inset;}100%{box-shadow:0 0 12px #ffffff88,0 0 18px #ffffff33 inset;}}
.actionButton:hover{color:#000;background:linear-gradient(145deg,#f2f2f2,#dcdcdc);border-color:#fff;transform:translateY(-2px) scale(1.04);animation:hoverPulse 1.6s infinite alternate;box-shadow:0 0 10px #ffffffcc,0 0 20px #ffffff66 inset;}
@keyframes hoverPulse{0%{box-shadow:0 0 8px #ffffff88,0 0 15px #ffffff33 inset;}100%{box-shadow:0 0 16px #ffffffcc,0 0 25px #ffffff66 inset;}}

.contracts-wrapper{display:flex; justify-content:center; align-items:flex-start; gap:15px; flex-wrap:wrap; width:100%;}
.total-cost-container{width:630px;height:418px;background-size:contain;background-position:center;background-repeat:no-repeat;position:relative;border-radius:15px;box-shadow:0 4px 8px rgba(0,0,0,0.5);display:none;}
#leftContainer{background-image:url('https://raw.githubusercontent.com/OreStellar/Orestellar.github.io/refs/heads/main/images/Contract1.png');}
#totalCostContainer{background-image:url('https://raw.githubusercontent.com/OreStellar/Orestellar.github.io/refs/heads/main/images/Contract2.png');}
#totalCostText{position:absolute;top:calc(50% + 10px);left:calc(50% - 53px);font-size:18px;font-weight:bold;color:#00ff00;text-shadow:0 0 12px #00ff00,0 0 24px #00ff00;cursor:pointer;}

/* Summary container */
.summary-container{display:none; flex-direction:column; align-items:stretch; justify-content:flex-start; font-family:'Orbitron',monospace; font-size:14px; line-height:1.4; color:#00ff00; background: rgba(0,10,0,0.9); border: 2px solid #00ff00; border-radius:12px; padding:16px 20px; min-width:400px; max-width:500px; max-height:420px; overflow-y:auto; overflow-x:hidden; box-shadow:0 0 15px rgba(0,255,0,0.5), inset 0 0 10px rgba(0,255,0,0.3); backdrop-filter:blur(6px); animation: pulseGlow 2s infinite alternate; scrollbar-width: thin; scrollbar-color: #00ff00 transparent;}
@keyframes pulseGlow{0%{box-shadow:0 0 12px rgba(0,255,0,0.5), inset 0 0 6px rgba(0,255,0,0.3);}100%{box-shadow:0 0 20px rgba(0,255,0,0.7), inset 0 0 12px rgba(0,255,0,0.5);}}
.summary-container::-webkit-scrollbar{width:6px;}
.summary-container::-webkit-scrollbar-thumb{background:#00ff00;border-radius:4px;box-shadow:0 0 10px #00ff00;}

/* Summary table */
.summary-table{width:100%;border-collapse:collapse;table-layout:fixed;}
.summary-table th, .summary-table td{padding:6px 10px;border-bottom:1px solid rgba(0,255,0,0.15);font-size:14px;white-space:nowrap;font-family:'Share Tech Mono', monospace;}
.summary-table th:nth-child(1), .summary-table td:nth-child(1){width:38%; text-align:left;}
.summary-table th:nth-child(2), .summary-table td:nth-child(2){width:20%; text-align:right;}
.summary-table th:nth-child(3), .summary-table td:nth-child(3){width:18%; text-align:center;}
.summary-table th:nth-child(4), .summary-table td:nth-child(4){width:24%; text-align:right;}
.summary-table th{text-align:center;color:#00ff00;text-shadow:0 0 6px #00ff00;border-bottom:1px solid rgba(0,255,0,0.3);}
.summary-table td.price,.summary-table td.total-column{font-variant-numeric:tabular-nums;letter-spacing:0.5px;}
.summary-table td.price::after{content:" ISK";color:rgba(0,255,0,0.6);font-size:12px;margin-left:3px;}
.summary-table td{color:#e0ffe0;text-shadow:none;}
.summary-table td.unrecognized{color:#ff4444 !important;text-shadow:0 0 12px #ff3333,0 0 24px #ff0000 !important;font-weight:bold;text-align:left !important;animation: unrecognizedGlow 1.5s infinite alternate;}
@keyframes unrecognizedGlow{0%,100%{text-shadow:0 0 12px #ff3333,0 0 24px #ff0000;}50%{text-shadow:0 0 18px #ff6666,0 0 28px #ff2222;}}

/* Total row */
.summary-total td{font-weight:bold;border-top:1px solid rgba(0,255,0,0.4);color:#00ff00;text-shadow:0 0 10px #00ff00,0 0 25px #00ff00;}
.summary-total td:first-child{text-align:right;}
.summary-total td:last-child{text-align:right;position:relative;}
.summary-total td:last-child::after{content:" ISK";color:rgba(0,255,0,0.8);font-size:13px;margin-left:4px;}

/* Sortable neon arrows */
.summary-table th{position:relative;transition:color 0.25s, text-shadow 0.3s;user-select:none;cursor:pointer;}
.summary-table th:hover{color:#00ffaa;text-shadow:0 0 8px #00ffaa;}
.summary-table th.sorted{color:#00ffcc;text-shadow:0 0 10px #00ffcc,0 0 25px #00ffcc;}
.summary-table th::after{content:"";position:absolute;right:8px;opacity:0;transition:opacity 0.2s;color:#00ffcc;text-shadow:0 0 8px #00ffcc,0 0 15px #00ffcc;font-size:12px;}
.summary-table th.sorted-asc::after{content:"▲";opacity:1;}
.summary-table th.sorted-desc::after{content:"▼";opacity:1;}

.quote-text {font-family:'Orbitron', sans-serif; font-size:1.6rem; font-weight:700; color:#fff; text-align:center; text-shadow:0 0 8px #fff,0 0 16px #fff,0 0 24px #00ff00,0 0 32px #00ff00; animation: softGlow 2.5s infinite alternate;}
</style>
<body data-show-inventory="true">

<canvas id="starfield"></canvas>

<div class="container-wrapper">
  <header id="myHeader">
    <h1 id="logoText"><span id="ore">Ore</span><span id="stellar">Stellar</span></h1>
  </header>

  <div class="main-container">
    <h3 class="quote-text">Paste Your Inventory Below</h3>
    <br>
    <textarea id="message" rows="8" placeholder="Compressed Ytirium 90143
Jet Ochre 13527
Magma Mercoxit 40599
Compressed Mordunium 592556
Bistot 1320"></textarea>
    <button id="submitButton" class="actionButton" disabled>Submit</button>
  </div>

  <div class="contracts-wrapper">
    <div id="leftContainer" class="total-cost-container"></div>
    <div id="summaryContainer" class="summary-container"></div>
    <div id="totalCostContainer" class="total-cost-container">
      <div id="totalCostText">0 ISK</div>
    </div>
  </div>

  <button id="shareButton" class="actionButton" style="display:none;">Share Summary</button>
</div>

<script>
// ===== HELPER FUNCTIONS =====
function formatNumber(n){return n.toLocaleString();}

// Simple fuzzy match for small typos
function findClosestOre(inputName, oreList){
  inputName = inputName.toLowerCase().trim();
  let closest = null, minDist = Infinity;
  oreList.forEach(name => {
    const dist = levenshteinDistance(inputName,name);
    if(dist < minDist && dist <= 2){ // allow max 2-char difference
      minDist = dist;
      closest = name;
    }
  });
  return closest;
}

// Levenshtein distance for fuzzy matching
function levenshteinDistance(a,b){
  const matrix = [];
  for(let i=0;i<=b.length;i++){matrix[i]=[i];}
  for(let j=0;j<=a.length;j++){matrix[0][j]=j;}
  for(let i=1;i<=b.length;i++){
    for(let j=1;j<=a.length;j++){
      if(b.charAt(i-1)===a.charAt(j-1)){matrix[i][j]=matrix[i-1][j-1];}
      else{matrix[i][j]=Math.min(matrix[i-1][j-1]+1,matrix[i][j-1]+1,matrix[i-1][j]+1);}
    }
  }
  return matrix[b.length][a.length];
}

// Base26 encode / decode
function base26Encode(str){
  return btoa(str).replace(/\+/g,'-').replace(/\//g,'_').replace(/=+$/,'');
}
function base26Decode(str){
  str = str.replace(/-/g,'+').replace(/_/g,'/');
  while(str.length%4) str+='=';
  return atob(str);
}

// ===== SHOW SUMMARY =====
function showContent(prefillText){
  const t = prefillText || document.getElementById('message').value;
  const regex = /([\w\s]+?)\s+(\d+)/g;
  let match, summaryMap={}, total=0;

  while((match=regex.exec(t))!==null){
    let nameRaw=match[1].trim();
    let qty=parseInt(match[2]);
    let nameKey=nameRaw.toLowerCase().replace(/\s+/g,' ');

    // Fuzzy match if not found
    if(priceList[nameKey]===undefined){
      const corrected=findClosestOre(nameKey,Object.keys(priceList));
      if(corrected){nameKey=corrected;}
    }

    const price=priceList[nameKey];
    const displayName=nameRaw.replace(/^Compressed /i,'Comp. ');

    if(price!==undefined){
      if(summaryMap[nameKey]){ 
        summaryMap[nameKey].qty+=qty; 
        summaryMap[nameKey].val=summaryMap[nameKey].qty*price; 
      } else {
        summaryMap[nameKey]={name:displayName,price:price,qty:qty,val:qty*price,unrecognized:false};
      }
      total+=qty*price;
    } else {
      summaryMap[nameKey]={name:displayName,price:'?',qty:qty,val:'Unrecognized',unrecognized:true};
    }
  }

  const summaryContainer=document.getElementById('summaryContainer');
  let tableHTML='<table class="summary-table"><thead><tr><th>Name</th><th class="price">Price</th><th class="quantity">Quantity</th><th>Total</th></tr></thead><tbody>';
  Object.values(summaryMap).forEach(item=>{
    tableHTML+=`<tr class="${item.unrecognized?'unrecognized':''}">
      <td>${item.name}</td>
      <td class="price">${item.unrecognized?item.price:formatNumber(item.price)}</td>
      <td class="quantity">${formatNumber(item.qty)}</td>
      <td class="${item.unrecognized?'total-column unrecognized':'total-column'}">${item.unrecognized?item.val:formatNumber(item.val)}</td>
    </tr>`;
  });
  tableHTML+=`<tr class="summary-total"><td colspan="3" style="text-align:right;">Total</td><td id="summaryTotal">${formatNumber(total)}</td></tr></tbody></table>`;
  summaryContainer.innerHTML=tableHTML;
  summaryContainer.style.display='flex';

  document.getElementById('leftContainer').style.display='block';
  document.getElementById('totalCostContainer').style.display='block';
  document.getElementById('totalCostText').innerText=formatNumber(total)+' ISK';

  // Hide inventory input
  document.querySelector('.main-container').style.display='none';
  document.getElementById('submitButton').style.display='none';
  document.getElementById('shareButton').style.display='inline-block';
}

// ===== SUBMIT BUTTON =====
const submitBtn=document.getElementById('submitButton');
const messageBox=document.getElementById('message');
messageBox.addEventListener('input',()=>{submitBtn.disabled=messageBox.value.trim()==='';});
submitBtn.addEventListener('click',()=>{showContent();window.scrollTo({top:0,behavior:'smooth'});});

// ===== SHARE BUTTON =====
document.getElementById('shareButton').addEventListener('click',()=>{
  const message=document.getElementById('message').value.trim();
  if(!message) return;
  const encoded=base26Encode(message);
  const shareURL=`${window.location.origin}${window.location.pathname}?s=${encoded}`;
  navigator.clipboard.writeText(shareURL).then(()=>{
    const btn=document.getElementById('shareButton');
    const originalText=btn.innerText;
    btn.innerText='Copied';
    setTimeout(()=>{btn.innerText=originalText;},1500);
  });
});

// ===== LOAD FROM URL =====
window.addEventListener('load',()=>{
  const params=new URLSearchParams(window.location.search);
  const s=params.get('s');
  if(s){
    const inventoryText=base26Decode(s);
    if(inventoryText){showContent(inventoryText);}
  }
});

</script>
</body>
</html>
