<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>OreStellar</title>

<!-- Google Font: Orbitron -->
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&display=swap" rel="stylesheet">

<script src="https://cdnjs.cloudflare.com/ajax/libs/lz-string/1.4.4/lz-string.min.js"></script>

<style>
html,body{margin:0;padding:0;height:100%;overflow:hidden;background:#000;font-family:monospace;color:#fff;}
canvas#starfield{position:fixed;top:0;left:0;width:100%;height:100%;z-index:0;pointer-events:none;}

/* Container */
.container-wrapper{display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:100vh;gap:20px;padding:20px;z-index:2;position:relative;}

/* Logo */
#myHeader{display:flex;justify-content:center;align-items:center;flex-direction:column;text-align:center;width:100%;max-width:650px;margin-bottom:30px;cursor:pointer;z-index:2;}
#logoText{display:inline;font-family:'Orbitron',sans-serif;font-weight:700;font-size:4.5rem;letter-spacing:0;color:rgba(255,255,255,0.1);transform:skewX(-8deg);}

/* Main Container */
.main-container{width:650px;max-width:90%;padding:30px;display:flex;flex-direction:column;justify-content:center;align-items:center;background-color:rgba(20,20,20,0.92);border-radius:15px;z-index:2;}
.main-container h3#inventoryHeader{font-family:'Orbitron',sans-serif;font-weight:700;color:#fff;text-shadow:0 0 12px #fff,0 0 18px #fff,0 0 24px #fff;margin-bottom:10px;}
.main-container textarea#message{display:block;margin:0 auto;width:92%;font-size:13px;color:#999;background-color:rgba(17,17,17,0.97);padding:10px;border-radius:10px;resize:vertical;border:1px solid #333;text-align:left;font-family:'Share Tech Mono',monospace;box-shadow:inset 0 0 5px #111;line-height:1.35;}
textarea#message:focus{outline:none;border-color:#fff;box-shadow:inset 0 0 15px #fff,0 0 25px #fff;}

/* Buttons */
.actionButton{margin-top:15px;background:linear-gradient(145deg,#161616,#242424);color:#fff;border:2px solid #ccc;border-radius:10px;padding:12px 26px;font-weight:bold;font-family:'Orbitron',sans-serif;cursor:pointer;position:relative;overflow:hidden;text-shadow:0 0 2px #fff;box-shadow:0 0 6px #ffffff33,0 0 12px #ffffff11 inset;transition:all 0.35s ease;}
.actionButton:disabled{opacity:0.5;cursor:not-allowed;}

/* Price Tab / Icon */
#priceTab{position:fixed;top:22vh;right:18px;width:48px;height:48px;border-radius:10px;background:#00ff00;color:#000;display:flex;justify-content:center;align-items:center;font-weight:700;font-size:20px;cursor:pointer;box-shadow:0 0 12px #00ff00,0 0 30px #00ff00 inset;z-index:30;transition:transform 0.18s ease, right 0.18s ease;font-family:'Orbitron',sans-serif;}
#priceTab::before{content:"\005A";position:absolute;top:7px;font-size:28px;}
#priceTab::after{content:"";position:absolute;top:22px;width:18px;height:2px;background:#000;} /* short horizontal, 1px down */
#priceListContainer{position:fixed;top:18vh;right:78px;width:320px;max-height:60vh;overflow-y:auto;background:rgba(0,0,0,0.95);border:1px solid #00ff00;padding:10px;border-radius:10px;display:none;box-shadow:0 0 18px #00ff00;z-index:29;font-family:'Share Tech Mono',monospace;color:#00ff00;}
#priceListContainer table{width:100%;border-collapse:collapse;}
#priceListContainer th,#priceListContainer td{padding:6px 8px;border-bottom:1px solid rgba(0,255,0,0.08);font-size:13px;text-align:left;}
#priceListContainer th{font-weight:700;color:#00ff00;}

/* Summary container */
.summary-container{display:none;flex-direction:column;align-items:stretch;justify-content:flex-start;font-family:'Share Tech Mono',monospace;font-size:14px;line-height:1.4;color:#00ff00;background:rgba(0,10,0,0.95);border:2px solid #00ff00;border-radius:12px;padding:16px 20px;min-width:420px;max-width:520px;max-height:60vh;overflow-y:auto;backdrop-filter:blur(6px);box-shadow:0 0 18px rgba(0,255,0,0.25);z-index:3;}
.summary-container::-webkit-scrollbar{width:8px;}
.summary-container::-webkit-scrollbar-thumb{background:#00ff00;border-radius:6px;box-shadow:0 0 10px #00ff00;}
.summary-table{width:100%;border-collapse:collapse;table-layout:fixed;}
.summary-table th, .summary-table td {padding:8px 10px;border-bottom:1px solid rgba(0,255,0,0.06);font-size:13px;white-space:nowrap;}
.summary-table th:nth-child(1), .summary-table td:nth-child(1){text-align:left;}
.summary-table td.price, .summary-table td.quantity, .summary-table td.total-column{text-align:right;font-variant-numeric:tabular-nums;}
.summary-table th{text-align:right;color:#00ff00;text-shadow:0 0 6px #00ff00;border-bottom:1px solid rgba(0,255,0,0.15);}
.summary-total td{border-top:2px solid rgba(0,255,0,0.25);font-weight:700;text-align:right;padding-top:10px;}
</style>
</head>
<body data-show-inventory="true">

<canvas id="starfield"></canvas>

<div class="container-wrapper">
  <header id="myHeader" title="Return home">
    <h1 id="logoText"><span id="ore">Ore</span><span id="stellar">Stellar</span></h1>
  </header>

  <div class="main-container" id="inventoryContainer">
    <h3 id="inventoryHeader">Paste Your Inventory Below</h3>
    <textarea id="message" rows="8">
Compressed Jet Ochre	3750
Compressed Prize Mordunium	998781
Compressed Pellucid Crokite	2912
Compressed Ducinium	4985
Compressed Pristine Jaspet	14237
Compressed Plunder Mordunium	218348
Compressed Plum Mordunium	141081
Hedbergite	3146
Eifyrium	93
Jaspet	756
Gneiss	106
Glazed Hedbergite	172
    </textarea>
    <button id="submitButton" class="actionButton">Submit</button>
  </div>

  <div id="summaryContainer" class="summary-container" aria-live="polite"></div>
  <div id="priceTab"></div>
  <div id="priceListContainer"></div>
</div>

<script>
/* ===== STARFIELD ===== */
const canvas = document.getElementById('starfield');
const ctx = canvas.getContext('2d');
function resizeCanvas(){ canvas.width = innerWidth; canvas.height = innerHeight; }
resizeCanvas(); window.addEventListener('resize', ()=>{ resizeCanvas(); createStars(); });

let stars = [];
function createStars(){
  stars = [];
  const centers = [];
  for(let i=0;i<10;i++) centers.push({x: Math.random()*canvas.width, y: Math.random()*canvas.height});
  const total = Math.floor(canvas.width*canvas.height/1600);
  for(let i=0;i<total;i++){
    let x,y;
    if(Math.random()<0.6){
      const c = centers[Math.floor(Math.random()*centers.length)];
      const r = Math.random()*140;
      const a = Math.random()*Math.PI*2;
      x = c.x+r*Math.cos(a); y = c.y+r*Math.sin(a);
    } else { x=Math.random()*canvas.width; y=Math.random()*canvas.height; }
    let color='#fff';
    const rand=Math.random();
    if(rand<0.05) color='#ff0000';
    else if(rand<0.08) color='#ff77ff';
    else if(rand<0.10) color='#00ffff';
    stars.push({x,y,size:Math.random()*1.4+0.3, color, speed:Math.random()*0.06+0.01, phase:Math.random()*Math.PI*2, twinkle:Math.random()<0.2, baseAlpha:0.85+Math.random()*0.15});
  }
}
createStars();
function drawStars(time=0){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  for(const s of stars){
    let alpha=s.baseAlpha;
    if(s.twinkle) alpha=0.5+0.4*Math.abs(Math.sin(time*0.002+s.phase));
    ctx.beginPath();
    ctx.globalAlpha=alpha;
    ctx.fillStyle=s.color;
    ctx.shadowBlur=alpha===1?s.size*8:s.size*4;
    ctx.shadowColor=s.color;
    ctx.arc(s.x,s.y,s.size,0,Math.PI*2); ctx.fill();
  }
  ctx.globalAlpha=1;
  requestAnimationFrame(drawStars);
}
requestAnimationFrame(drawStars);

/* ===== LOGO ANIMATION ===== */
const logoText=document.getElementById('logoText');
function animateLogoFlicker(){
  logoText.style.color='rgba(255,255,255,0.1)'; logoText.style.textShadow='none';
  setTimeout(()=>{ logoText.style.color='#fff'; logoText.style.textShadow='0 0 12px #fff,0 0 18px #fff'; },100);
  setTimeout(()=>{ logoText.style.color='rgba(255,255,255,0.1)'; logoText.style.textShadow='none'; },250);
  setTimeout(()=>{ logoText.style.color='#fff'; logoText.style.textShadow='0 0 12px #fff,0 0 18px #fff'; },400);
  setTimeout(()=>{ logoText.style.color='rgba(255,255,255,0.1)'; logoText.style.textShadow='none'; },550);
  setTimeout(()=>{ logoText.style.color='#fff'; logoText.style.textShadow='0 0 12px #fff,0 0 18px #fff,0 0 24px #fff'; },700);
}
animateLogoFlicker();

/* ===== LOAD CSV, FILTER, AND PRICE 150% ===== */
async function loadPriceCSV(){
  const res = await fetch('https://raw.githubusercontent.com/OreStellar/Orestellar.github.io/main/data/prices.csv');
  const text = await res.text();
  const lines = text.split('\n').map(l=>l.trim()).filter(l=>l!=='');
  const priceList={};
  lines.forEach((line,i)=>{
    if(i===0) return; // skip header
    const [name,,suggested] = line.split(',');
    if(!name.toLowerCase().includes('compressed') && suggested){
      const price = parseFloat(suggested) * 1.5;
      priceList[name.trim()]=price;
    }
  });
  renderPriceList(priceList);
  window.priceListRaw = priceList;
}
loadPriceCSV();

/* ===== RENDER PRICE LIST ===== */
const priceListContainer = document.getElementById('priceListContainer');
function renderPriceList(priceList){
  const baseSet=new Set();
  Object.keys(priceList).forEach(k=>{ baseSet.add(k); });
  const baseArray=Array.from(baseSet).sort();
  let html='<table><tr><th>Ore</th><th>Price</th></tr>';
  baseArray.forEach(base=>{
    html+=`<tr><td>${base}</td><td>${priceList[base].toFixed(2)}</td></tr>`;
  });
  html+='</table>';
  priceListContainer.innerHTML=html;
}

/* ===== TOGGLE PRICE LIST ===== */
document.getElementById('priceTab').addEventListener('click', ()=>{
  priceListContainer.style.display = priceListContainer.style.display==='none'?'block':'none';
});

/* ===== INVENTORY SUBMIT ===== */
const submitBtn=document.getElementById('submitButton');
submitBtn.addEventListener('click', ()=>{
  const text=document.getElementById('message').value;
  renderSummary(text);
});

/* ===== RENDER SUMMARY ===== */
const summaryContainer = document.getElementById('summaryContainer');
function renderSummary(text){
  const lines = text.trim().split(/\r?\n/).filter(l=>l.trim()!=='');
  let total=0;
  let html='<table class="summary-table"><tr><th>Ore</th><th>Quantity</th><th>Price</th><th>Total</th></tr>';
  lines.forEach(line=>{
    const parts=line.split(/\t+/);
    if(parts.length<2) return;
    const name=parts[0].trim();
    const qty=parseInt(parts[1].replace(/,/g,''))||0;
    const price=window.priceListRaw[name]||0;
    const t=qty*price;
    total+=t;
    html+=`<tr><td>${name}</td><td class="quantity">${qty.toLocaleString()}</td><td class="price">${price.toLocaleString()}</td><td class="total-column">${t.toLocaleString()}</td></tr>`;
  });
  html+=`<tr class="summary-total"><td colspan="3">Total</td><td>${total.toLocaleString()}</td></tr></table>`;
  summaryContainer.innerHTML=html;
  summaryContainer.style.display='flex';
}
</script>
</body>
</html>
