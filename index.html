<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>OreStellar</title>

<!-- Google Font: Orbitron -->
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&display=swap" rel="stylesheet">

<!-- LZString for URL compression -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/lz-string/1.4.4/lz-string.min.js"></script>

<style>
html,body{margin:0;padding:0;height:100%;overflow:hidden;background:black;font-family:monospace;color:white;}
canvas#starfield{position:fixed;top:0;left:0;width:100%;height:100%;z-index:0;pointer-events:none;}

.container-wrapper{display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:100vh;gap:20px;padding:20px;z-index:2;position:relative;}
#myHeader{display:flex;justify-content:center;align-items:center;flex-direction:column;text-align:center;width:100%;max-width:650px;margin-bottom:30px;cursor:pointer;z-index:2;}
#logoText{display:inline;font-family:'Orbitron',sans-serif;font-weight:700;font-size:4.5rem;letter-spacing:0;color:rgba(255,255,255,0.1);transform:skewX(-8deg);}
#logoText span{display:inline;color:rgba(255,255,255,0.1);text-shadow:none;}

@keyframes softGlow{0%,100%{text-shadow:0 0 5px #fff;color:rgba(255,255,255,0.75);}50%{text-shadow:0 0 15px #fff;color:rgba(255,255,255,1);}}
@keyframes flickerRapid{0%,20%,40%,60%,80%,100%{color: rgba(255,255,255,1);text-shadow:0 0 10px #fff;}10%,30%,50%,70%,90%{color: rgba(255,255,255,0.1);text-shadow:none;}}
@keyframes flickerQuick{0%,50%,100%{color: rgba(255,255,255,0.1);text-shadow:none;}25%,75%{color: rgba(255,255,255,1);text-shadow:0 0 10px #fff;}}

.main-container{width:650px;max-width:90%;padding:30px;display:flex;flex-direction:column;justify-content:center;align-items:center;background-color:rgba(20,20,20,0.92);border-radius:15px;}
.main-container textarea#message{display:block;margin:0 auto;width:92%;font-size:18px;padding:18px;border-radius:10px;resize:vertical;background-color:rgba(17,17,17,0.97);color:#fff;border:1px solid #333;text-align:left;font-family:'Share Tech Mono', monospace;box-shadow:inset 0 0 5px #111;transition: all 0.2s ease-in-out;}
.main-container textarea#message::placeholder{color:#fff;opacity:0.6;}
textarea#message:focus{outline:none;border-color:#fff;box-shadow:inset 0 0 15px #fff,0 0 25px #fff;transition:box-shadow 0.3s ease,border-color 0.3s ease;}

.actionButton{margin-top:15px;background:linear-gradient(145deg,#161616,#242424);color:#fff;border:2px solid #ccc;border-radius:10px;padding:15px 35px;font-weight:bold;font-family:'Orbitron',sans-serif;cursor:pointer;position:relative;overflow:hidden;text-shadow:0 0 2px #fff;box-shadow:0 0 6px #ffffff33,0 0 12px #ffffff11 inset;animation:ambientGlow 3.5s ease-in-out infinite alternate;transition:all 0.35s ease;}
@keyframes ambientGlow{0%{box-shadow:0 0 4px #ffffff33,0 0 8px #ffffff11 inset;}100%{box-shadow:0 0 12px #ffffff88,0 0 18px #ffffff33 inset;}}
.actionButton:hover{color:#000;background:linear-gradient(145deg,#f2f2f2,#dcdcdc);border-color:#fff;transform:translateY(-2px) scale(1.04);animation:hoverPulse 1.6s infinite alternate;box-shadow:0 0 10px #ffffffcc,0 0 20px #ffffff66 inset;}
@keyframes hoverPulse{0%{box-shadow:0 0 8px #ffffff88,0 0 15px #ffffff33 inset;}100%{box-shadow:0 0 16px #ffffffcc,0 0 25px #ffffff66 inset;}}

.contracts-wrapper{display:flex;justify-content:center;align-items:flex-start;gap:15px;flex-wrap:wrap;width:100%;}
.total-cost-container{width:630px;height:418px;background-size:contain;background-position:center;background-repeat:no-repeat;position:relative;border-radius:15px;box-shadow:0 4px 8px rgba(0,0,0,0.5);display:none;}
#leftContainer{background-image:url('https://raw.githubusercontent.com/OreStellar/Orestellar.github.io/refs/heads/main/images/Contract1.png');}
#totalCostContainer{background-image:url('https://raw.githubusercontent.com/OreStellar/Orestellar.github.io/refs/heads/main/images/Contract2.png');}
#totalCostText{position:absolute;top:calc(50% + 10px);left:calc(50% - 53px);font-size:18px;font-weight:bold;color:#00ff00;text-shadow:0 0 12px #00ff00,0 0 24px #00ff00;cursor:pointer;}

/* Summary container */
.summary-container{
  display:none;
  flex-direction:column;
  align-items:stretch;
  justify-content:flex-start;
  font-family:'Orbitron',monospace;
  font-size:14px;
  line-height:1.4;
  color:#00ff00;
  background: rgba(0,10,0,0.9);
  border: 2px solid #00ff00;
  border-radius:12px;
  padding:16px 20px;
  min-width:400px;
  max-width:500px;
  max-height:420px;
  overflow-y:auto;
  overflow-x:hidden;
  box-shadow:0 0 15px rgba(0,255,0,0.5), inset 0 0 10px rgba(0,255,0,0.3);
  backdrop-filter:blur(6px);
  animation: pulseGlow 2s infinite alternate;
  scrollbar-width: thin;
  scrollbar-color: #00ff00 transparent;
}
@keyframes pulseGlow{
  0%{box-shadow:0 0 12px rgba(0,255,0,0.5), inset 0 0 6px rgba(0,255,0,0.3);}
  100%{box-shadow:0 0 20px rgba(0,255,0,0.7), inset 0 0 12px rgba(0,255,0,0.5);}
}
.summary-container::-webkit-scrollbar{width:6px;}
.summary-container::-webkit-scrollbar-thumb{background:#00ff00;border-radius:4px;box-shadow:0 0 10px #00ff00;}

/* Summary table */
.summary-table{width:100%;border-collapse:collapse;table-layout:fixed;}
.summary-table th, .summary-table td{padding:6px 10px;border-bottom:1px solid rgba(0,255,0,0.15);font-size:14px;white-space:nowrap;font-family:'Share Tech Mono', monospace;}
.summary-table th:nth-child(1), .summary-table td:nth-child(1){width:38%; text-align:left;}
.summary-table th:nth-child(2), .summary-table td:nth-child(2){width:20%; text-align:right;}
.summary-table th:nth-child(3), .summary-table td:nth-child(3){width:18%; text-align:center;}
.summary-table th:nth-child(4), .summary-table td:nth-child(4){width:24%; text-align:right;}
.summary-table th{text-align:center;color:#00ff00;text-shadow:0 0 6px #00ff00;border-bottom:1px solid rgba(0,255,0,0.3);}
.summary-table td.price,.summary-table td.total-column{font-variant-numeric:tabular-nums;letter-spacing:0.5px;}
.summary-table td.price::after{content:" ISK";color:rgba(0,255,0,0.6);font-size:12px;margin-left:3px;}
.summary-table td{color:#e0ffe0;text-shadow:none;}
.summary-table td.unrecognized{color:#ff4444 !important;text-shadow:0 0 12px #ff3333,0 0 24px #ff0000 !important;font-weight:bold;text-align:left !important;animation: unrecognizedGlow 1.5s infinite alternate;}
@keyframes unrecognizedGlow{0%,100%{text-shadow:0 0 12px #ff3333,0 0 24px #ff0000;}50%{text-shadow:0 0 18px #ff6666,0 0 28px #ff2222;}}

/* Total row */
.summary-total td{font-weight:bold;border-top:1px solid rgba(0,255,0,0.4);color:#00ff00;text-shadow:0 0 10px #00ff00,0 0 25px #00ff00;}
.summary-total td:first-child{text-align:right;}
.summary-total td:last-child{text-align:right;position:relative;}
.summary-total td:last-child::after{content:" ISK";color:rgba(0,255,0,0.8);font-size:13px;margin-left:4px;}

/* Sortable neon arrows */
.summary-table th{position:relative;transition:color 0.25s, text-shadow 0.3s;user-select:none;cursor:pointer;}
.summary-table th:hover{color:#00ffaa;text-shadow:0 0 8px #00ffaa;}
.summary-table th.sorted{color:#00ffcc;text-shadow:0 0 10px #00ffcc,0 0 25px #00ffcc;}
.summary-table th::after{content:"";position:absolute;right:8px;opacity:0;transition:opacity 0.2s;color:#00ffcc;text-shadow:0 0 8px #00ffcc,0 0 15px #00ffcc;font-size:12px;}
.summary-table th.sorted-asc::after{content:"▲";opacity:1;}
.summary-table th.sorted-desc::after{content:"▼";opacity:1;}
  .quote-text {
  font-family: 'Orbitron', sans-serif;    /* match logo font */
  font-size: 1.6rem;                      /* larger text */
  font-weight: 700;
  color: #fff;                             /* white text */
  text-align: center;
  text-shadow: 
    0 0 8px #fff,
    0 0 16px #fff,
    0 0 24px #00ff00,
    0 0 32px #00ff00;                     /* neon glow effect */
  animation: softGlow 2.5s infinite alternate;  /* subtle pulsing */
}

</style>
</head>
<body data-show-inventory="true">

<canvas id="starfield"></canvas>

<div class="container-wrapper">
  <header id="myHeader">
    <h1 id="logoText"><span id="ore">Ore</span><span id="stellar">Stellar</span></h1>
  </header>

<div class="main-container">
  <!-- ===== BLUEPRINT HEADER ===== -->
  <h3 class="quote-text">Paste Your Inventory Below</h3>
  <br>
  <textarea id="message" rows="8" placeholder="Compressed Ytirium 90143
Jet Ochre 13527
Magma Mercoxit 40599
Compressed Mordunium 592556
Bistot 1320"></textarea>
  <button id="submitButton" class="actionButton" disabled>Submit</button>
</div>


  <div class="contracts-wrapper">
    <div id="leftContainer" class="total-cost-container"></div>
    <div id="summaryContainer" class="summary-container"></div>
    <div id="totalCostContainer" class="total-cost-container">
      <div id="totalCostText">0 ISK</div>
    </div>
  </div>

  <button id="shareButton" class="actionButton" style="display:none;">Share Summary</button>
</div>

<script>
/* ================================
   OreStellar Smart Inventory Parser
   ================================ */

let priceList = {}; // will be filled dynamically
const oreNames = []; // will store recognized ore names

// Fetch ore names and prices from your CSV
fetch('data/prices.csv')
  .then(res => res.text())
  .then(text => {
    const rows = text.split('\n').slice(1, 191); // rows 2–191
    rows.forEach(row => {
      const cols = row.split(',');
      const name = cols[0]?.trim();
      const price = parseFloat(cols[1]) || 0;
      if (name) {
        oreNames.push(name.toLowerCase());
        priceList[name.toLowerCase()] = price;
      }
    });
  });

// ===============================
// Utility Functions
// ===============================
function formatNumber(num) {
  if (isNaN(num)) return '---';
  return num.toLocaleString('en-US', { maximumFractionDigits: 2 });
}

function makeTotalCopyable(element) {
  element.addEventListener('click', () => {
    navigator.clipboard.writeText(element.textContent.replace(' ISK','').trim());
    element.classList.add('copied');
    setTimeout(() => element.classList.remove('copied'), 800);
  });
}

// ===============================
// Smart Inventory Parsing
// ===============================
function parseInventoryText(t) {
  const lines = t.split(/\r?\n/);
  const summary = [];

  lines.forEach(line => {
    let foundOre = null;
    let foundQty = null;
    let foundM3 = null;
    let foundISK = null;

    const lower = line.toLowerCase();
    const words = lower.split(/[\t, ]+/);

    // Look for first recognized ore name
    for (let i = 0; i < words.length; i++) {
      for (const ore of oreNames) {
        const oreParts = ore.split(' ');
        if (oreParts.every((p, j) => words[i + j] === p)) {
          foundOre = ore;
          break;
        }
      }
      if (foundOre) break;
    }

    if (!foundOre) return; // skip line entirely if no match

    // Extract numbers
    const numbers = line.match(/[\d,]+(?:\.\d+)?/g) || [];

    // Assign meaning to numbers
    if (numbers.length > 0) foundQty = parseFloat(numbers[0].replace(/,/g, ''));
    if (numbers.length > 1) {
      const maybeM3 = line.includes('m3');
      const maybeISK = line.toLowerCase().includes('isk');
      if (maybeM3) foundM3 = parseFloat(numbers[numbers.length - 2]?.replace(/,/g, ''));
      if (maybeISK) foundISK = parseFloat(numbers[numbers.length - 1]?.replace(/,/g, ''));
    }

    summary.push({
      name: foundOre,
      qty: foundQty || 0,
      m3: foundM3 || 0,
      isk: foundISK || 0,
      unrecognized: false
    });
  });

  // Detect unrecognized or incomplete
  return summary.map(item => {
    if (!oreNames.includes(item.name?.toLowerCase())) {
      item.unrecognized = true;
    }
    return item;
  });
}

// ===============================
// Display Function
// ===============================
function showContent(prefillText) {
  const t = prefillText || document.getElementById('message').value;
  const inventory = parseInventoryText(t);

  let tableHTML = '<table class="summary-table"><thead><tr><th>Name</th><th class="price">Price</th><th class="quantity">Quantity</th><th>Total</th></tr></thead><tbody>';
  let total = 0;

  inventory.forEach(item => {
    const displayName = item.unrecognized ? item.name.slice(0, 10) : item.name;
    const itemPrice = priceList[item.name?.toLowerCase()] || 0;
    const itemTotal = item.unrecognized ? 0 : item.qty * itemPrice;

    tableHTML += `<tr class="${item.unrecognized ? 'unrecognized' : ''}">
      <td>${displayName}</td>
      <td class="price">${item.unrecognized ? '---' : formatNumber(itemPrice)}</td>
      <td class="quantity">${item.unrecognized ? '---' : formatNumber(item.qty)}</td>
      <td class="${item.unrecognized ? 'total-column unrecognized' : 'total-column'}">${item.unrecognized ? 'Unrecognized' : formatNumber(itemTotal)}</td>
    </tr>`;

    if (!item.unrecognized) total += itemTotal;
  });

  tableHTML += `<tr class="summary-total">
    <td colspan="3" style="text-align:right;">Total</td>
    <td id="summaryTotal">${formatNumber(total)}</td>
  </tr></tbody></table>`;

  const summaryContainer = document.getElementById('summaryContainer');
  summaryContainer.innerHTML = tableHTML;
  summaryContainer.style.display = 'flex';

  document.getElementById('leftContainer').style.display = 'block';
  document.getElementById('totalCostContainer').style.display = 'block';

  const totalText = document.getElementById('totalCostText');
  totalText.innerText = formatNumber(total) + ' ISK';
  makeTotalCopyable(totalText);
  makeTotalCopyable(document.getElementById('summaryTotal'));

  attachSorting(summaryContainer);

  document.querySelector('.main-container').style.display = 'none';
  document.getElementById('submitButton').style.display = 'none';
  document.getElementById('shareButton').style.display = 'inline-block';
}

// ===============================
// Sorting
// ===============================
function attachSorting(container) {
  const headers = container.querySelectorAll('th');
  headers.forEach((th, i) => {
    th.addEventListener('click', () => {
      const rows = Array.from(container.querySelectorAll('tbody tr')).slice(0, -1);
      const asc = !th.classList.contains('asc');
      headers.forEach(h => h.classList.remove('asc', 'desc'));
      th.classList.add(asc ? 'asc' : 'desc');
      rows.sort((a, b) => {
        const getValue = row => row.children[i].innerText.replace(/,/g, '');
        const A = parseFloat(getValue(a)) || getValue(a);
        const B = parseFloat(getValue(b)) || getValue(b);
        return asc ? (A > B ? 1 : -1) : (A < B ? 1 : -1);
      });
      rows.forEach(r => container.querySelector('tbody').insertBefore(r, container.querySelector('tbody tr.summary-total')));
    });
  });
}

// ===============================
// Stars Animation + Logo
// ===============================
document.addEventListener('DOMContentLoaded', () => {
  const canvas = document.getElementById('stars');
  if (canvas) {
    const ctx = canvas.getContext('2d');
    let stars = [];
    const numStars = 300;

    function resize() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      stars = Array.from({ length: numStars }, () => ({
        x: Math.random() * canvas.width,
        y: Math.random() * canvas.height,
        z: Math.random() * canvas.width
      }));
    }

    function draw() {
      ctx.fillStyle = 'black';
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      for (const s of stars) {
        s.z -= 2;
        if (s.z <= 0) s.z = canvas.width;
        const k = 128.0 / s.z;
        const px = s.x * k + canvas.width / 2;
        const py = s.y * k + canvas.height / 2;
        if (px >= 0 && px <= canvas.width && py >= 0 && py <= canvas.height) {
          const size = (1 - s.z / canvas.width) * 3;
          ctx.fillStyle = 'rgba(0,255,180,0.7)';
          ctx.beginPath();
          ctx.arc(px, py, size, 0, Math.PI * 2);
          ctx.fill();
        }
      }
      requestAnimationFrame(draw);
    }

    window.addEventListener('resize', resize);
    resize();
    draw();
  }
});
</script>

</body>
</html>
