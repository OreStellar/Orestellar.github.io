<!DOCTYPE html>
<html>
<head>
<title>OreStellar</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel="stylesheet" href="https://www.w3schools.com/lib/w3-theme-black.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.3.0/css/font-awesome.min.css">

<style>
html, body {
    background-color: black;
    color: white;
    margin: 0;
    padding: 0;
    height: 100%;
}

body {
    display: flex;
    flex-direction: column;
}

header {
    flex-shrink: 0; /* Prevent header from shrinking */
}

.container-wrapper {
    display: flex;
    height: 100%;
    padding: 20px;
    box-sizing: border-box;
}

.main-container {
    flex: 1; /* Main container takes available space */
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
}

.w3-card, .w3-container {
    background-color: #333;
    color: white; /* Solid dark grey background */
    opacity: 1; /* Ensure full opacity */
    border-radius: 15px; /* Add rounded corners */
}

.full-width-textarea {
    width: 100%;
    box-sizing: border-box; /* Ensures padding is included in the width */
    margin-bottom: 20px; /* Add margin below textarea */
    resize: none; /* Prevent resizing */
    height: 100%; /* Fill the height of the container */
}

.hidden {
    display: none;
}

.total-cost-container {
    width: 300px; /* Width of the new container */
    background-color: #333;
    color: white;
    border-radius: 15px;
    padding: 20px;
    margin-left: 20px; /* Space between containers */
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
}
</style>
</head>
<body>

<header class="w3-container w3-theme w3-padding" id="myHeader">
  <div class="w3-center">
    <img src="images/OreStellar Header.png" alt="Header Image" style="width: 300px; height: auto;">
  </div>
  <hr>
</header>

<div class="container-wrapper">
  <div class="main-container w3-card w3-container w3-center">
    <h3>Quote</h3><br>
    <div class="form-container">
      <form action="/submit" method="post" class="full-height">
        <textarea id="message" name="message" class="w3-input w3-border w3-round full-width-textarea" rows="8" cols="50" placeholder="Copy and paste your inventory here..&#10;&#10;Ytirium  82460&#10;Jet Ochre 1045&#10;Compressed Ytirium 60253&#10;Compressed Ducinium 2402"></textarea>
      </form>
      <button onclick="showContent()" class="w3-button w3-black w3-round">Submit</button>
    </div>
  </div>

  <div id="totalCostContainer" class="total-cost-container hidden">
    <p id="totalCostText" class="w3-center">Total cost will appear here</p>
  </div>
</div>

<script>
const priceList = {
    "Ytirium": 5.00,          // Price per unit
    "Jet Ochre": 10.00,       // Price per unit
    "Compressed Ytirium": 7.50, // Price per unit
    "Compressed Ducinium": 12.00 // Price per unit
};

// Function to add commas to a number
function formatNumberWithCommas(number) {
    return number.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
}

function showContent() {
    var totalCostContainer = document.getElementById('totalCostContainer');
    var textarea = document.getElementById('message').value;

    // Reset content before updating
    document.getElementById('totalCostText').innerHTML = '';  

    // Define regex pattern
    var regex = /([\w\s]+?)\s+(\d+)/g;
    var matches;
    var totalCost = 0;
    var invalidItems = [];

    // Iterate through all matches
    while ((matches = regex.exec(textarea)) !== null) {
        var item = matches[1].trim();
        var quantity = parseInt(matches[2]);

        if (priceList[item] !== undefined) {
            var price = priceList[item];
            var cost = quantity * price;
            totalCost += cost;
        } else {
            invalidItems.push(item); // Collect invalid items
        }
    }

    var resultText = '<strong>Total Cost: ' + formatNumberWithCommas(totalCost.toFixed(2)) + ' isk</strong>';
    
    // Show invalid items, if any
    if (invalidItems.length > 0) {
        resultText += '<br><br><span style="color: red;">Unrecognized items: ' + invalidItems.join(', ') + '</span>';
    }

    // Display total cost and invalid items
    document.getElementById('totalCostText').innerHTML = resultText;
    totalCostContainer.classList.remove('hidden');
}
</script>

</body>
</html>
