<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>OreStellar</title>

<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&display=swap" rel="stylesheet">

<script src="https://cdnjs.cloudflare.com/ajax/libs/lz-string/1.4.4/lz-string.min.js"></script>

<style>
/* ===== RESET & BODY ===== */
html, body {
  margin: 0;
  padding: 0;
  height: 100%;
  overflow: hidden;
  background-color: #000;
  font-family: monospace;
  color: #fff;
}

/* ===== STARFIELD ===== */
canvas#starfield {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: 0;
  pointer-events: none;
}

/* ===== CONTAINER ===== */
.container-wrapper {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  min-height: 100vh;
  gap: 20px;
  padding: 20px;
  z-index: 2;
  position: relative;
}

/* ===== LOGO ===== */
#myHeader {
  display: flex;
  justify-content: center;
  align-items: center;
  flex-direction: column;
  text-align: center;
  width: 100%;
  max-width: 650px;
  margin-bottom: 30px;
  cursor: pointer;
  z-index: 2;
}

#logoText {
  display: inline;
  font-family: 'Orbitron', sans-serif;
  font-weight: 700;
  font-size: 4.5rem;
  letter-spacing: 0;
  color: rgba(255,255,255,0.1);
  transform: skewX(-8deg);
  animation: softGlow 3s infinite alternate;
}

#logoText span {
  display: inline;
  color: rgba(255,255,255,0.1);
  text-shadow: none;
  animation: flickerSequence 2s infinite;
}

/* Flicker animation: two flashes → one flash → stays on */
@keyframes flickerSequence {
  0%, 10% { color: #fff; text-shadow: 0 0 10px #fff; }
  15%, 25% { color: rgba(255,255,255,0.1); text-shadow: none; }
  30%, 40% { color: #fff; text-shadow: 0 0 10px #fff; }
  50%, 100% { color: #fff; text-shadow: 0 0 10px #fff; }
}

@keyframes softGlow {
  0%, 100% { text-shadow: 0 0 5px #fff; color: rgba(255,255,255,0.75); }
  50% { text-shadow: 0 0 15px #fff; color: rgba(255,255,255,1); }
}

/* ===== MAIN CONTAINER ===== */
.main-container {
  width: 650px;
  max-width: 90%;
  padding: 30px;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  background-color: rgba(20,20,20,0.92);
  border-radius: 15px;
  z-index: 2;
}

/* Inventory Header */
#inventoryHeader {
  font-family: 'Orbitron', sans-serif;
  font-weight: 700;
  color: #fff;
  text-shadow: 0 0 12px #fff, 0 0 18px #fff, 0 0 24px #fff;
  margin-bottom: 12px;
  padding-bottom: 8px;
}

/* Inventory Textarea */
#message {
  display: block;
  margin: 0 auto;
  width: 92%;
  font-size: 13px;
  color: #777; /* grey placeholder text */
  background-color: rgba(17,17,17,0.97);
  padding: 10px;
  border-radius: 10px;
  resize: none;
  border: 1px solid #333;
  text-align: left;
  font-family: 'Share Tech Mono', monospace;
  box-shadow: inset 0 0 5px #111;
  line-height: 1.35;
  transition: all 0.2s ease-in-out;
}

/* Focused textarea */
#message:focus {
  outline: none;
  border-color: #fff;
  box-shadow: inset 0 0 15px #fff, 0 0 25px #fff;
  transition: box-shadow 0.3s ease, border-color 0.3s ease;
}

/* ===== BUTTONS ===== */
.actionButton {
  margin-top: 15px;
  background: linear-gradient(145deg, #161616, #242424);
  color: #fff;
  border: 2px solid #ccc;
  border-radius: 10px;
  padding: 12px 26px;
  font-weight: bold;
  font-family: 'Orbitron', sans-serif;
  cursor: pointer;
  position: relative;
  overflow: hidden;
  text-shadow: 0 0 2px #fff;
  box-shadow: 0 0 6px #ffffff33, 0 0 12px #ffffff11 inset;
  animation: ambientGlow 3.5s ease-in-out infinite alternate;
  transition: all 0.35s ease;
}

.actionButton:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

@keyframes ambientGlow {
  0% { box-shadow: 0 0 4px #ffffff33, 0 0 8px #ffffff11 inset; }
  100% { box-shadow: 0 0 12px #ffffff88, 0 0 18px #ffffff33 inset; }
}

/* ===== CONTRACTS ===== */
.contracts-wrapper {
  display: flex;
  justify-content: center;
  align-items: flex-start;
  gap: 15px;
  flex-wrap: wrap;
  width: 100%;
}

.total-cost-container {
  width: 630px;
  height: 418px;
  background-size: contain;
  background-position: center;
  background-repeat: no-repeat;
  position: relative;
  border-radius: 15px;
  box-shadow: 0 4px 8px rgba(0,0,0,0.5);
  display: none;
}

#leftContainer {
  background-image: url('https://raw.githubusercontent.com/OreStellar/Orestellar.github.io/refs/heads/main/images/Contract1.png');
  display: none;
}

#totalCostContainer {
  background-image: url('https://raw.githubusercontent.com/OreStellar/Orestellar.github.io/refs/heads/main/images/Contract2.png');
  display: none;
  position: relative;
}

#totalCostText {
  position: absolute;
  top: 18px;
  right: 20px;
  color: #00ff00;
  font-family: 'Share Tech Mono', monospace;
  font-weight: bold;
  font-size: 18px;
  text-shadow: 0 0 6px #00ff00, 0 0 12px #00ff00;
  cursor: pointer;
}

/* ===== PRICE LIST ICON ===== */
#priceTab {
  position: fixed;
  top: 22vh;
  right: 18px;
  width: 48px;
  height: 48px;
  border-radius: 10px;
  background: #00ff00;
  color: #000;
  display: flex;
  justify-content: center;
  align-items: center;
  font-weight: 700;
  font-size: 20px;
  cursor: pointer;
  box-shadow: 0 0 12px #00ff00, 0 0 30px #00ff00 inset;
  z-index: 30;
  transition: transform 0.18s ease, right 0.18s ease;
  font-family: 'Orbitron', sans-serif;
}

#priceTab::before {
  content: "\005A";
  position: absolute;
  top: 7px;
  font-size: 28px;
}

#priceTab::after {
  content: "";
  position: absolute;
  top: 22px;
  width: 16px;
  height: 2px;
  background: #000;
}

/* ===== PRICE LIST CONTAINER ===== */
#priceListContainer {
  position: fixed;
  top: 18vh;
  right: 78px;
  width: 320px;
  max-height: 60vh;
  overflow-y: auto;
  background: rgba(0,0,0,0.95);
  border: 1px solid #00ff00;
  padding: 10px;
  border-radius: 10px;
  display: none;
  box-shadow: 0 0 18px #00ff00;
  z-index: 29;
  font-family: 'Share Tech Mono', monospace;
  color: #00ff00;
}

#priceListContainer table {
  width: 100%;
  border-collapse: collapse;
}

#priceListContainer th, #priceListContainer td {
  padding: 6px 8px;
  border-bottom: 1px solid rgba(0,255,0,0.08);
  font-size: 13px;
  text-align: left;
}

#priceListContainer th { font-weight: 700; color: #00ff00; }

/* ===== SUMMARY CONTAINER ===== */
.summary-container {
  display: none;
  flex-direction: column;
  align-items: stretch;
  justify-content: flex-start;
  font-family: 'Share Tech Mono', monospace;
  font-size: 14px;
  line-height: 1.4;
  color: #00ff00;
  background: rgba(0,10,0,0.95);
  border: 2px solid #00ff00;
  border-radius: 12px;
  padding: 16px 20px;
  min-width: 420px;
  max-width: 520px;
  max-height: 60vh;
  overflow-y: auto;
  backdrop-filter: blur(6px);
  box-shadow: 0 0 18px rgba(0,255,0,0.25);
  z-index: 3;
}

.summary-container::-webkit-scrollbar { width: 8px; }
.summary-container::-webkit-scrollbar-thumb {
  background: #00ff00;
  border-radius: 6px;
  box-shadow: 0 0 10px #00ff00;
}

/* ===== SUMMARY TABLE ===== */
.summary-table {
  width: 100%;
  border-collapse: collapse;
  table-layout: fixed;
}

.summary-table th, .summary-table td {
  padding: 8px 10px;
  border-bottom: 1px solid rgba(0,255,0,0.06);
  font-size: 13px;
  white-space: nowrap;
}

.summary-table th:nth-child(1), .summary-table td:nth-child(1) { text-align: left; }
.summary-table td.price, .summary-table td.quantity, .summary-table td.total-column { text-align: right; font-variant-numeric: tabular-nums; }
.summary-table th { text-align: right; color: #00ff00; text-shadow: 0 0 6px #00ff00; border-bottom: 1px solid rgba(0,255,0,0.15); }
.summary-total td { border-top: 2px solid rgba(0,255,0,0.25); font-weight: 700; text-align: right; padding-top: 10px; }
</style>
</head>
<body data-show-inventory="true">

<canvas id="starfield"></canvas>

<div class="container-wrapper">
  <header id="myHeader" title="Return home">
    <h1 id="logoText"><span id="ore">Ore</span><span id="stellar">Stellar</span></h1>
  </header>

  <div class="main-container" id="inventoryContainer">
    <h3 id="inventoryHeader">Paste Your Inventory Below</h3>
    <textarea id="message" rows="8" readonly>
Compressed Jet Ochre	3750
Compressed Prize Mordunium	998781
Compressed Pellucid Crokite	2912
Compressed Ducinium	4985
Compressed Pristine Jaspet	14237
Compressed Plunder Mordunium	218348
Compressed Plum Mordunium	141081
Hedbergite	3146
Eifyrium	93
Jaspet	756
Gneiss	106
Glazed Hedbergite	172
    </textarea>
    <button id="submitButton" class="actionButton">Submit</button>
  </div>

  <div class="contracts-wrapper">
    <div id="leftContainer" class="total-cost-container"></div>
    <div id="summaryContainer" class="summary-container" aria-live="polite"></div>
    <div id="totalCostContainer" class="total-cost-container">
      <div id="totalCostText">0 ISK</div>
    </div>
  </div>

  <div id="priceTab"></div>
  <div id="priceListContainer"></div>
</div>

<script>
/* ===== STARFIELD ===== */
const canvas = document.getElementById('starfield');
const ctx = canvas.getContext('2d');

function resizeCanvas() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
window.addEventListener('resize', () => { resizeCanvas(); createStars(); });
resizeCanvas();

let stars = [];
function createStars() {
  stars = [];
  const totalStars = Math.max(400, Math.floor(canvas.width * canvas.height / 600));
  for (let i = 0; i < totalStars; i++) {
    const x = Math.random() * canvas.width;
    const y = Math.random() * canvas.height;
    const rand = Math.random();
    let color = '#fff';
    if (rand < 0.05) color = '#ff0000';
    else if (rand < 0.08) color = '#ff77ff';
    else if (rand < 0.10) color = '#99ccff';
    stars.push({
      x, y,
      size: Math.random() * 1.4 + 0.3,
      color,
      speed: Math.random() * 0.06 + 0.01,
      phase: Math.random() * Math.PI * 2,
      twinkle: Math.random() < 0.2,
      baseAlpha: 0.85 + Math.random() * 0.15
    });
  }
}
createStars();

function drawStars(time=0) {
  ctx.clearRect(0,0,canvas.width,canvas.height);
  for (const s of stars) {
    let alpha = s.baseAlpha;
    if (s.twinkle) alpha = 0.5 + 0.4 * Math.abs(Math.sin(time*0.002+s.phase));
    ctx.beginPath();
    ctx.globalAlpha = alpha;
    ctx.fillStyle = s.color;
    ctx.shadowBlur = alpha === 1 ? s.size*8 : s.size*4;
    ctx.shadowColor = s.color;
    ctx.arc(s.x,s.y,s.size,0,Math.PI*2);
    ctx.fill();
  }
  ctx.globalAlpha = 1;
  requestAnimationFrame(drawStars);
}
requestAnimationFrame(drawStars);

/* ===== INVENTORY INTERACTION ===== */
const messageBox = document.getElementById('message');
messageBox.addEventListener('focus', () => {
  if (messageBox.readOnly) {
    messageBox.value = '';
    messageBox.style.color = '#ccc';
    messageBox.readOnly = false;
  }
});

const submitBtn = document.getElementById('submitButton');
submitBtn.addEventListener('click', () => {
  messageBox.style.color = '#999';
  document.getElementById('inventoryContainer').style.display='none';
  document.getElementById('leftContainer').style.display='block';
  document.getElementById('totalCostContainer').style.display='block';
  renderSummary(messageBox.value);
});

/* ===== PRICE LIST RAW ===== */
const priceListRaw = {
  "Ytirium":4.55,"Gneiss":1.25,"Obsidian Ochre":0.89,"Eifyrium":2.45,"Dark Ochre":1.12,"Jet Ochre":0.88,
  "Prize Mordunium":6.55,"Pellucid Crokite":1.01,"Ducinium":1.55,"Pristine Jaspet":1.95,"Plunder Mordunium":5.55,"Plum Mordunium":4.95,
  "Hedbergite":1.1,"Glazed Hedbergite":1.22,"Jaspet":0.95
};

/* ===== BASE ORES & VARIANTS ===== */
function buildPriceListWithVariants(raw) {
  const baseSet = new Set();
  Object.keys(raw).forEach(k => { if(!k.toLowerCase().includes('compressed')) baseSet.add(k); });
  const baseArray = Array.from(baseSet).sort();
  return baseArray.map(base => {
    const variants = Object.keys(raw).filter(x => x.toLowerCase().includes(base.toLowerCase()) && !x.toLowerCase().includes('compressed'));
    let price = raw[base] || 0;
    if(variants.length > 0) price = raw[variants[0]] || price;
    return {base, variants, price};
  });
}

/* ===== RENDER PRICE LIST ===== */
const priceListContainer = document.getElementById('priceListContainer');
function renderPriceList() {
  const list = buildPriceListWithVariants(priceListRaw);
  let html = '<table><tr><th>Ore</th><th>Price</th></tr>';
  list.forEach(o => {
    html += `<tr><td>${o.base}</td><td>${o.price}</td></tr>`;
    if(o.variants.length > 1) {
      o.variants.forEach(v => { if(v!==o.base) html+=`<tr><td> - ${v}</td><td>${priceListRaw[v]||0}</td></tr>`; });
    }
  });
  html += '</table>';
  priceListContainer.innerHTML = html;
}
renderPriceList();

/* ===== TOGGLE PRICE LIST ===== */
document.getElementById('priceTab').addEventListener('click', () => {
  priceListContainer.style.display = priceListContainer.style.display === 'none' ? 'block' : 'none';
});

/* ===== RENDER SUMMARY ===== */
const summaryContainer = document.getElementById('summaryContainer');
function renderSummary(text) {
  const lines = text.trim().split(/\r?\n/).filter(l=>l.trim()!=='');
  let total = 0;
  let html = '<table class="summary-table"><tr><th>Ore</th><th>Quantity</th><th>Price</th><th>Total</th></tr>';
  lines.forEach(line => {
    const parts = line.split(/\t+/);
    if(parts.length < 2) return;
    const name = parts[0].trim();
    const qty = parseInt(parts[1].replace(/,/g,'')) || 0;
    const price = priceListRaw[name] || 0;
    const t = qty * price;
    total += t;
    html += `<tr><td>${name}</td><td class="quantity">${qty.toLocaleString()}</td><td class="price">${price.toLocaleString()}</td><td class="total-column">${t.toLocaleString()}</td></tr>`;
  });
  html += `<tr class="summary-total"><td colspan="3">Total</td><td>${total.toLocaleString()}</td></tr></table>`;
  summaryContainer.innerHTML = html;
  summaryContainer.style.display='flex';
}
</script>
</body>
</html>
