<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>OreStellar</title>

<!-- Google Font -->
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">

<style>
/* ðŸŒŒ STAR BACKGROUND */
#stars, #stars2, #stars3 {
  position: fixed;
  top: 0; left: 0;
  width: 100%;
  height: 100%;
  display: block;
  background: transparent url('https://orestellar.github.io/images/stars.png') repeat top center;
  z-index: -1;
}
#stars { animation: moveStars 50s linear infinite; }
#stars2 { animation: moveStars 100s linear infinite; opacity: 0.5; }
#stars3 { animation: moveStars 150s linear infinite; opacity: 0.3; }

@keyframes moveStars {
  from { background-position: 0 0; }
  to { background-position: -10000px 5000px; }
}

/* ðŸŒ  NEON THEME */
body {
  font-family: 'Orbitron', sans-serif;
  background-color: #000;
  color: #00ffff;
  text-shadow: 0 0 10px #00ffff;
  margin: 0;
  padding: 0;
  overflow-x: hidden;
}

header {
  text-align: center;
  margin-top: 20px;
}

.logo {
  width: 200px;
  height: auto;
  display: block;
  margin: 20px auto;
  filter: drop-shadow(0 0 10px #00ffcc);
  transition: transform 0.3s ease;
}
.logo:hover {
  transform: scale(1.05);
  filter: drop-shadow(0 0 20px #00ffcc);
}

/* ðŸ§¾ MAIN CONTAINER */
main {
  max-width: 900px;
  margin: 50px auto;
  background: rgba(0, 0, 0, 0.7);
  border-radius: 20px;
  padding: 20px;
  box-shadow: 0 0 20px #00ffff;
}

/* ðŸ§® TEXTAREA & BUTTON */
textarea {
  width: 100%;
  height: 200px;
  background: rgba(0, 0, 0, 0.6);
  color: #00ffff;
  border: 1px solid #00ffff;
  border-radius: 10px;
  padding: 10px;
  box-shadow: 0 0 10px #00ffff;
  resize: none;
}

button {
  background: rgba(0, 0, 0, 0.6);
  border: 1px solid #00ffff;
  color: #00ffff;
  border-radius: 10px;
  padding: 10px 20px;
  cursor: pointer;
  margin-top: 10px;
  transition: all 0.2s ease-in-out;
}
button:hover {
  background-color: rgba(0, 255, 204, 0.2);
  box-shadow: 0 0 20px #00ffff;
}

/* ðŸ“Š SUMMARY TABLE */
#summary {
  width: 100%;
  margin-top: 20px;
  border-collapse: collapse;
  text-align: center;
}

#summary th, #summary td {
  padding: 10px;
  border-bottom: 1px solid #00ffff;
}

#summary th {
  color: #00ffff;
  font-weight: bold;
}

#summary td.unrecognized {
  color: #ff4444;
  text-shadow: 0 0 8px #ff4444;
}
</style>
</head>

<body>
<div id="stars"></div>
<div id="stars2"></div>
<div id="stars3"></div>

<header>
  <a href="https://orestellar.github.io/">
    <img src="logo.png" alt="OreStellar Logo" class="logo">
  </a>
</header>

<main>
  <h2>Paste Your Inventory Here</h2>
  <textarea id="inventoryInput" placeholder="Paste your inventory text here..."></textarea>
  <button id="submitButton">Process Inventory</button>

  <table id="summary">
    <thead>
      <tr>
        <th>Ore Name</th>
        <th>Price</th>
        <th>Quantity</th>
        <th>Total</th>
      </tr>
    </thead>
    <tbody id="summaryBody"></tbody>
  </table>
</main>

<script>
/* === STEP 1: FETCH RECOGNIZED ORE NAMES FROM CSV === */
let recognizedOres = new Set();

fetch('https://orestellar.github.io/data/prices.csv')
  .then(res => res.text())
  .then(text => {
    const lines = text.split(/\r?\n/);
    for (let i = 1; i <= 191 && i < lines.length; i++) {
      const cols = lines[i].split(',');
      if (cols[0]) recognizedOres.add(cols[0].trim().toLowerCase());
    }
  });

/* === STEP 2: PARSER === */
function parseInventoryText(text) {
  const lines = text.split(/\r?\n/);
  const inventory = [];

  for (const line of lines) {
    const cleaned = line.trim();
    if (!cleaned) continue;

    // Try to find a recognized ore
    const foundOre = Array.from(recognizedOres).find(ore => 
      cleaned.toLowerCase().includes(ore)
    );

    if (foundOre) {
      const numberMatch = cleaned.match(/(\d{1,3}(?:,\d{3})*|\d+)(?=\D|$)/);
      const qty = numberMatch ? parseInt(numberMatch[0].replace(/,/g, '')) : 0;
      inventory.push({ name: foundOre, qty, unrecognized: false });
    } else {
      // unrecognized line
      const firstWord = cleaned.split(/\s+/)[0].slice(0,10);
      inventory.push({ name: firstWord, qty: 0, unrecognized: true });
    }
  }

  return inventory;
}

/* === STEP 3: DISPLAY FUNCTION === */
document.getElementById("submitButton").addEventListener("click", () => {
  const text = document.getElementById("inventoryInput").value;
  const parsed = parseInventoryText(text);
  const tbody = document.getElementById("summaryBody");
  tbody.innerHTML = "";

  parsed.forEach(item => {
    const row = document.createElement("tr");

    const nameCell = document.createElement("td");
    nameCell.textContent = item.name.length > 10 ? item.name.slice(0,10) : item.name;

    const priceCell = document.createElement("td");
    const qtyCell = document.createElement("td");
    const totalCell = document.createElement("td");

    if (item.unrecognized) {
      priceCell.textContent = "---";
      qtyCell.textContent = "---";
      totalCell.textContent = "Unrecognized";
      totalCell.classList.add("unrecognized");
    } else {
      // (You can later link your price data here)
      priceCell.textContent = "Loading...";
      qtyCell.textContent = item.qty;
      totalCell.textContent = "â€”";
    }

    row.append(nameCell, priceCell, qtyCell, totalCell);
    tbody.appendChild(row);
  });
});
</script>
</body>
</html>
